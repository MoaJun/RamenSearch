import{j as e,M as ve,r as x,X as ee,I as xe,L as Ne,S as ke,C as se,R as W,T as Ce,a as Se,b as ue,c as re,d as ne,e as Me,A as $e,f as D,g as G,B as he,h as _e,H as U,N as Ie,E as Ee,i as Re,k as te,l as Ae,U as Pe,m as Te,n as Le,o as ze,p as Oe}from"./vendor-CTygwWxc.js";import{g as Fe,f as B}from"./utils-BbDP4c6b.js";import{L as Ue}from"./google-maps-C1qYM-EM.js";const De="modulepreload",Ge=function(s){return"/"+s},de={},He=function(t,r,m){let i=Promise.resolve();if(r&&r.length>0){let d=function(o){return Promise.all(o.map(c=>Promise.resolve(c).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),g=n?.nonce||n?.getAttribute("nonce");i=d(r.map(o=>{if(o=Ge(o),o in de)return;de[o]=!0;const c=o.endsWith(".css"),y=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${y}`))return;const j=document.createElement("link");if(j.rel=c?"stylesheet":De,c||(j.as="script"),j.crossOrigin="",j.href=o,g&&j.setAttribute("nonce",g),document.head.appendChild(j),c)return new Promise((f,a)=>{j.addEventListener("load",f),j.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${o}`)))})}))}function b(d){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=d,window.dispatchEvent(n),!n.defaultPrevented)throw d}return i.then(d=>{for(const n of d||[])n.status==="rejected"&&b(n.reason);return t().catch(b)})},us=({onOpen:s})=>e.jsx("button",{onClick:s,className:"fixed bottom-5 right-5 z-50 flex items-center justify-center w-14 h-14 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-gray-900","aria-label":"フィードバックを送信",children:e.jsx(ve,{className:"w-7 h-7"})}),hs=({isOpen:s,onClose:t,onSubmit:r})=>{const[m,i]=x.useState("suggestion"),[b,d]=x.useState(""),[n,g]=x.useState(null),[o,c]=x.useState(!1),y=x.useRef(null),j=u=>{if(u.target.files&&u.target.files[0]){const C=u.target.files[0],R=new FileReader;R.onload=$=>{g($.target?.result)},R.readAsDataURL(C)}},f=x.useCallback(()=>{i("suggestion"),d(""),g(null),y.current&&(y.current.value="")},[]),a=async u=>{if(u.preventDefault(),!b.trim()){alert("詳細を入力してください。");return}c(!0);const C={type:m,details:b,screenshot:n||void 0};try{if(!(await fetch("http://localhost:8080/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)})).ok)throw new Error("Server responded with an error");r(C),t()}catch(R){console.error("Failed to submit feedback:",R),alert("フィードバックの送信に失敗しました。後でもう一度お試しください。")}finally{c(!1)}};return x.useEffect(()=>{const u=C=>{C.key==="Escape"&&t()};return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u)}},[t]),x.useEffect(()=>{s||setTimeout(()=>{f(),c(!1)},300)},[s,f]),s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 transition-opacity animate-fade-in-fast",onClick:t,role:"dialog","aria-modal":"true","aria-labelledby":"feedback-modal-title",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-md m-4 transform transition-transform animate-slide-in-bottom",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-800",children:[e.jsx("h2",{id:"feedback-modal-title",className:"text-xl font-bold text-white",children:"フィードバックを送信"}),e.jsx("button",{onClick:t,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",children:e.jsx(ee,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"フィードバックの種類"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"feedbackType",value:"suggestion",checked:m==="suggestion",onChange:u=>i(u.target.value),className:"form-radio h-4 w-4 text-red-500 bg-gray-800 border-gray-600 focus:ring-red-500"}),e.jsx("span",{className:"text-gray-200",children:"ご意見・ご要望"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"feedbackType",value:"bug",checked:m==="bug",onChange:u=>i(u.target.value),className:"form-radio h-4 w-4 text-red-500 bg-gray-800 border-gray-600 focus:ring-red-500"}),e.jsx("span",{className:"text-gray-200",children:"バグ報告"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"details",className:"block text-sm font-medium text-gray-300 mb-2",children:"詳細"}),e.jsx("textarea",{id:"details",value:b,onChange:u=>d(u.target.value),placeholder:"改善点や問題点など、詳しくお聞かせください。",className:"w-full p-3 border border-gray-700 rounded-lg shadow-sm focus:ring-2 focus:ring-red-500 transition bg-gray-800 text-white min-h-[120px]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"スクリーンショット (任意)"}),n?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:n,alt:"Screenshot preview",className:"rounded-lg max-h-40 w-auto"}),e.jsx("button",{type:"button",onClick:()=>{g(null),y.current&&(y.current.value="")},className:"absolute top-2 right-2 bg-black bg-opacity-60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"画像を削除",children:e.jsx(ee,{className:"w-4 h-4"})})]}):e.jsxs("button",{type:"button",onClick:()=>y.current?.click(),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 border-2 border-dashed border-gray-600 rounded-lg text-gray-400 hover:border-gray-500 hover:text-gray-300 transition-colors",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:"クリックして画像を選択"})]}),e.jsx("input",{type:"file",ref:y,onChange:j,className:"hidden",accept:"image/*"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-800 flex justify-end",children:e.jsx("button",{type:"submit",disabled:!b.trim()||o,className:"flex items-center justify-center bg-red-600 text-white font-bold px-6 py-2.5 rounded-lg hover:bg-red-700 transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed w-32",children:o?e.jsx(Ne,{className:"w-5 h-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"送信する"})]})})})]})]})}):null},fs=({message:s,show:t})=>{const[r,m]=x.useState(!1);return x.useEffect(()=>{if(t)m(!0);else{const i=setTimeout(()=>m(!1),300);return()=>clearTimeout(i)}},[t]),r?e.jsxs("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 z-50 flex items-center p-4 mb-4 text-sm font-semibold text-green-100 bg-green-600 rounded-lg shadow-lg transition-all duration-300 ${t?"opacity-100 translate-y-0":"opacity-0 -translate-y-5"}`,role:"alert",children:[e.jsx(se,{className:"w-5 h-5 mr-3"}),e.jsx("span",{className:"font-medium",children:s})]}):null},Be=()=>e.jsx("div",{className:"space-y-4 animate-pulse",children:[...Array(3)].map((s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"h-5 w-32 bg-gray-200 dark:bg-gray-700 rounded-md mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-full bg-gray-200 dark:bg-gray-700 rounded-md"}),e.jsx("div",{className:"h-4 w-5/6 bg-gray-200 dark:bg-gray-700 rounded-md"})]})]},t))}),X=({title:s,points:t,icon:r,borderColorClass:m,textColorClass:i})=>!t||t.length===0?null:e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-800/50 border-l-4 p-4 rounded-r-lg ${m}`,children:[e.jsxs("h4",{className:`font-bold flex items-center mb-2 ${i}`,children:[r,e.jsx("span",{className:"ml-2",children:s})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300",children:t.map((b,d)=>e.jsx("li",{children:b},d))})]}),We=({placeId:s,reviews:t})=>{const[r,m]=x.useState(null),[i,b]=x.useState(!0),[d,n]=x.useState(null);return x.useEffect(()=>{(async()=>{if(!t||t.length===0){b(!1);return}b(!0),n(null);try{const o=t.map(y=>y.text).join(`

`),c=await Fe(s,o);m(c)}catch(o){console.error("Failed to generate review summary:",o),n("AIによる要約の生成に失敗しました。")}finally{b(!1)}})()},[s,t]),i?e.jsx(Be,{}):d?e.jsx("p",{className:"text-red-500 text-sm",children:d}):!r||r.goodPoints.length===0&&r.badPoints.length===0&&r.tips.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"要約を生成するのに十分なレビューがありません。"}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{title:"良い点",points:r.goodPoints,icon:e.jsx(Ce,{className:"w-5 h-5"}),borderColorClass:"border-green-400 dark:border-green-500",textColorClass:"text-green-700 dark:text-green-400"}),e.jsx(X,{title:"惜しい点",points:r.badPoints,icon:e.jsx(Se,{className:"w-5 h-5"}),borderColorClass:"border-red-400 dark:border-red-500",textColorClass:"text-red-700 dark:text-red-400"}),e.jsx(X,{title:"ヒント",points:r.tips,icon:e.jsx(ue,{className:"w-5 h-5"}),borderColorClass:"border-blue-400 dark:border-blue-500",textColorClass:"text-blue-700 dark:text-blue-400"})]})},fe=W.memo(We),qe=({isOpen:s,photos:t,currentIndex:r,onClose:m,onPrevious:i,onNext:b,shopName:d})=>{if(!s)return null;const n=g=>{g.target===g.currentTarget&&m()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:n,children:e.jsxs("div",{className:"relative max-w-7xl max-h-screen w-full h-full flex items-center justify-center p-4",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors","aria-label":"モーダルを閉じる",children:e.jsx(ee,{className:"h-6 w-6"})}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-3 rounded-full hover:bg-black/70 transition-colors","aria-label":"前の写真",children:e.jsx(re,{className:"h-6 w-6"})}),e.jsx("button",{onClick:b,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-3 rounded-full hover:bg-black/70 transition-colors","aria-label":"次の写真",children:e.jsx(ne,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"relative flex items-center justify-center w-full h-full",children:e.jsx("img",{src:t[r]?.large||t[r]?.medium||"",alt:`${d} - ${r+1}`,className:"max-w-full max-h-full object-contain rounded-lg"})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium",children:d}),e.jsxs("div",{className:"text-xs text-gray-300 mt-1",children:[r+1," / ",t.length]})]})}),t.length>1&&e.jsx("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 flex space-x-2 bg-black/50 p-2 rounded-lg max-w-sm overflow-x-auto",children:t.map((g,o)=>e.jsx("button",{onClick:()=>{},className:`flex-shrink-0 w-12 h-12 rounded-md overflow-hidden border-2 transition-colors ${o===r?"border-white":"border-transparent hover:border-white/50"}`,children:e.jsx("img",{src:g.small||g.medium||"",alt:`${d} thumbnail ${o+1}`,className:"w-full h-full object-cover"})},o))})]})})},Ke=({hours:s,isOpenNow:t})=>{const r=()=>{const n=new Date,g=n.getHours(),o=n.getMinutes(),c=g*60+o,y=s.match(/(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})/);if(y){const j=parseInt(y[1]),f=parseInt(y[2]),a=parseInt(y[3]),u=parseInt(y[4]),C=j*60+f,R=a*60+u;if(t&&c<R){const $=R-c,E=Math.floor($/60),N=$%60;return $<60?`あと${$}分で閉店`:E===1&&N===0?"あと1時間で閉店":N===0?`あと${E}時間で閉店`:`あと${E}時間${N}分で閉店`}if(!t&&c<C){const $=C-c,E=Math.floor($/60),N=$%60;return $<60?`あと${$}分で開店`:E===1&&N===0?"あと1時間で開店":N===0?`あと${E}時間で開店`:`あと${E}時間${N}分で開店`}}return null},m=()=>{const n=["日","月","火","水","木","金","土"],g=new Date().getDay(),o=n[g];if(s.includes("月曜日")||s.includes("火曜日")||s.includes("日曜日")){const y=s.split(`
`).find(j=>j.includes(`${o}曜日`));if(y)return{todayJp:o,todayLine:y}}return{todayJp:o,todayLine:null}},i=r(),{todayJp:b,todayLine:d}=m();return e.jsx("div",{children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Me,{className:"h-4 w-4 mr-2 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:`inline-flex items-center text-sm font-semibold px-2 py-1 rounded-full ${t?"bg-green-600 text-green-100":"bg-gray-600 text-gray-100"}`,children:t?"営業中":"営業時間外"}),i&&e.jsx("span",{className:"text-sm text-blue-400 font-medium",children:i}),e.jsxs("span",{className:"text-xs bg-blue-600 text-blue-100 px-2 py-1 rounded-full",children:[b,"曜日"]})]}),d?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-blue-300 font-medium bg-blue-600/20 px-2 py-1 rounded text-sm",children:d}),s.split(`
`).length>1&&e.jsxs("details",{className:"text-gray-400 text-sm",children:[e.jsx("summary",{className:"cursor-pointer hover:text-gray-300",children:"他の曜日を表示"}),e.jsx("div",{className:"mt-2 pl-4 space-y-1",children:s.split(`
`).filter(n=>!n.includes(`${b}曜日`)).map((n,g)=>e.jsx("div",{className:"text-gray-400",children:n},g))})]})]}):e.jsx("div",{className:"text-gray-300 whitespace-pre-line",children:s})]})]})})},Je=W.memo(Ke),Ve=W.lazy(()=>He(()=>Promise.resolve().then(()=>ds),void 0)),Ye=({shop:s,onBack:t,isBookmarked:r,isVisited:m,isFavorite:i,onBookmarkToggle:b,onStatusToggle:d})=>{const[n,g]=x.useState(0),[o,c]=x.useState(!1),[y,j]=x.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-200",children:[e.jsx("header",{className:"sticky top-0 z-30 bg-gray-900 border-b border-gray-800 px-4 py-3",children:e.jsxs("button",{onClick:t,className:"flex items-center text-gray-300 hover:text-white transition-colors",children:[e.jsx($e,{className:"h-5 w-5 mr-2"}),"戻る"]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.photos[n]?.large||s.photos[0]?.medium||"",alt:`${s.name} - ${n+1}`,className:"w-full h-64 object-cover cursor-pointer",onClick:()=>j(!0)}),s.photos.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(f=>f===0?s.photos.length-1:f-1),className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors","aria-label":"前の写真",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>g(f=>f===s.photos.length-1?0:f+1),className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors","aria-label":"次の写真",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-sm",children:[n+1," / ",s.photos.length]}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-2",children:s.photos.map((f,a)=>e.jsx("button",{onClick:()=>g(a),className:`w-2 h-2 rounded-full transition-colors ${a===n?"bg-white":"bg-white/50"}`,"aria-label":`写真 ${a+1} に移動`},a))})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center mb-4 flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 text-yellow-500 mr-1",fill:"currentColor"}),e.jsx("span",{className:"text-yellow-500 font-bold",children:s.rating.toFixed(1)})]}),e.jsxs("div",{className:"flex items-center text-gray-400",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[Math.round(s.distance),"m"]})]}),s.isOpenNow?e.jsx("span",{className:"inline-flex items-center text-sm font-semibold px-3 py-1 rounded-full bg-green-600 text-green-100",children:"営業中"}):e.jsx("span",{className:"inline-flex items-center text-sm font-semibold px-3 py-1 rounded-full bg-gray-600 text-gray-100",children:"営業時間外"})]}),e.jsx("p",{className:"text-gray-300 mb-4",children:s.address}),e.jsxs("div",{className:"flex space-x-2 mb-6",children:[e.jsxs("button",{onClick:b,className:`flex items-center px-4 py-2 rounded-lg transition-colors ${r?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),r?"ブックマーク済み":"ブックマーク"]}),e.jsxs("button",{onClick:()=>d("visited"),className:`flex items-center px-4 py-2 rounded-lg transition-colors ${m?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),m?"行った":"行く"]}),e.jsxs("button",{onClick:()=>d("favorite"),className:`flex items-center px-4 py-2 rounded-lg transition-colors ${i?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"お気に入り"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"地図・アクセス"}),e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"w-full h-64 bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"})}),children:e.jsx(Ve,{shop:s,apiKey:""})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-400 space-y-1",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s.address]}),s.accessInfo&&e.jsxs("p",{className:"flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),s.accessInfo]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"店舗情報"}),e.jsxs("div",{className:"space-y-2 text-gray-300",children:[e.jsx(Je,{hours:s.hours,isOpenNow:s.isOpenNow}),(s.twitterUrl||s.instagramUrl)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 text-gray-400"}),s.twitterUrl?e.jsx("a",{href:s.twitterUrl,className:"text-blue-400 hover:text-blue-300",children:"X (Twitter)"}):e.jsx("a",{href:s.instagramUrl,className:"text-blue-400 hover:text-blue-300",children:"Instagram"})]}),s.parkingInfo&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Re,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("span",{children:s.parkingInfo})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"移動時間目安"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"現在地または検索地点から"}),e.jsxs("div",{className:"space-y-2 text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"🚶"}),e.jsx("span",{children:"徒歩"})]}),e.jsxs("span",{className:"font-semibold",children:["約",Math.ceil(s.distance/80),"分 (",Math.round(s.distance),"m)"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"🚗"}),e.jsx("span",{children:"車"})]}),e.jsxs("span",{className:"font-semibold",children:["約",Math.max(1,Math.ceil(s.distance/400)),"分"]})]})]})]})]})]}),s.photos&&s.photos.length>1&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"ラーメンの写真"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.photos.slice(1,7).map((f,a)=>e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg bg-gray-800",children:e.jsx("img",{src:f.medium||f.large||"",alt:`${s.name}のラーメン ${a+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200 cursor-pointer",onClick:()=>{g(a+1),j(!0)}})},a+1))}),s.photos.length>7&&e.jsxs("p",{className:"text-sm text-gray-400 mt-2 text-center",children:["他にも",s.photos.length-7,"枚の写真があります"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"レビュー"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Googleレビュー ",s.reviews.length,"件"]})]}),s.reviews&&s.reviews.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-medium mb-3 text-blue-400",children:"AI要約"}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4",children:e.jsx(fe,{placeId:s.placeId,reviews:s.reviews})})]}),e.jsxs("div",{className:"space-y-3",children:[(o?s.reviews:s.reviews.slice(0,2)).map((f,a)=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((u,C)=>e.jsx(D,{className:`w-4 h-4 ${C<f.rating?"text-yellow-400":"text-gray-500"}`,fill:"currentColor"},C))}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:f.author})]}),f.relative_time_description&&e.jsx("span",{className:"text-xs text-gray-400",children:f.relative_time_description})]}),e.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-line",children:f.text})]},a)),s.reviews.length>2&&e.jsxs("button",{onClick:()=>c(!o),className:"w-full text-center text-blue-400 hover:text-blue-300 font-semibold text-sm flex items-center justify-center",children:[o?"レビューを閉じる":`他のレビュー${s.reviews.length-2}件を表示`,e.jsx(te,{className:`w-4 h-4 ml-1 transition-transform ${o?"rotate-180":""}`})]})]})]})]})]})]})}),e.jsx(qe,{isOpen:y,photos:s.photos,currentIndex:n,onClose:()=>j(!1),onPrevious:()=>g(f=>f===0?s.photos.length-1:f-1),onNext:()=>g(f=>f===s.photos.length-1?0:f+1),shopName:s.name})]})},ps=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"})),pe=({photo:s,className:t,sizes:r})=>{if(!s)return e.jsx("div",{className:`bg-gray-200 dark:bg-gray-700 ${t}`});const m=`${s.small} 400w, ${s.medium} 800w, ${s.large} 1200w`;return e.jsx("img",{src:s.small,srcSet:m,sizes:r,alt:s.alt,className:t,loading:"lazy"})},Xe=({shop:s,size:t="medium",className:r="",showLabel:m=!1})=>{const[i,b]=x.useState(!1),[d,n]=x.useState(!1),g={small:"w-6 h-6",medium:"w-8 h-8",large:"w-10 h-10"},o={small:"p-1",medium:"p-2",large:"p-3"};x.useEffect(()=>{c()},[s.placeId]);const c=async()=>{try{const j=await B.isFavorite(s.placeId);b(j)}catch(j){console.error("Error checking favorite status:",j)}},y=async j=>{if(j.stopPropagation(),!d){n(!0);try{i?(await B.removeFromFavorites(s.placeId),b(!1)):(await B.addToFavorites(s),b(!0))}catch(f){console.error("Error toggling favorite:",f),alert("お気に入りの更新に失敗しました。もう一度お試しください。")}finally{n(!1)}}};return e.jsxs("button",{onClick:y,disabled:d,className:`
        ${o[t]}
        inline-flex items-center justify-center
        rounded-full
        transition-all duration-200
        ${i?"text-red-500 hover:text-red-600 hover:bg-red-50":"text-gray-400 hover:text-red-500 hover:bg-gray-50"}
        ${d?"opacity-50 cursor-not-allowed":"hover:scale-110"}
        ${r}
      `,title:i?"お気に入りから削除":"お気に入りに追加","aria-label":i?"お気に入りから削除":"お気に入りに追加",children:[e.jsx(U,{className:`${g[t]} ${i?"fill-current":""}`}),m&&e.jsx("span",{className:"ml-1 text-sm font-medium",children:i?"お気に入り":"お気に入りに追加"})]})},Qe=({status:s})=>{const t={混雑:{text:"混雑",color:"text-red-600 dark:text-red-500",bgColor:"bg-red-100 dark:bg-red-900/50"},普通:{text:"普通",color:"text-yellow-600 dark:text-yellow-500",bgColor:"bg-yellow-100 dark:bg-yellow-900/50"},空席あり:{text:"空席あり",color:"text-green-600 dark:text-green-500",bgColor:"bg-green-100 dark:bg-green-900/50"},不明:{text:"不明",color:"text-gray-500 dark:text-gray-400",bgColor:"bg-gray-100 dark:bg-gray-700"}},{text:r,color:m,bgColor:i}=t[s];return e.jsxs("span",{className:`inline-flex items-center text-xs font-semibold px-2 py-1 rounded-full ${i} ${m}`,children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),r]})},me=({review:s})=>e.jsxs("div",{className:"py-2 border-b border-gray-100 dark:border-gray-700/50 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,r)=>e.jsx(D,{className:`w-3.5 h-3.5 ${r<s.rating?"text-yellow-400":"text-gray-400 dark:text-gray-500"}`,fill:"currentColor"},r))}),e.jsx("p",{className:"ml-2 font-semibold text-gray-700 dark:text-gray-300 text-sm",children:s.author})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed line-clamp-3",children:s.text})]}),Ze=({shop:s,onSelect:t,index:r,isHovered:m,isHighlighted:i,onMouseEnter:b,onMouseLeave:d,onClick:n})=>{const[g,o]=x.useState(!1),[c,y]=x.useState(!1),[j,f]=x.useState(0),a=4,u=s.reviews.slice(1),C=Math.ceil(u.length/a),R=u.slice(j*a,(j+1)*a),$=N=>{N.stopPropagation(),g&&f(0),o(!g)},E=N=>{N.stopPropagation(),y(!c)};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-all duration-300 group ${i?"ring-2 ring-blue-500 shadow-lg transform scale-105":m?"ring-2 ring-red-500":""}`,onMouseEnter:b,onMouseLeave:d,onClick:n,children:[e.jsxs("div",{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",onClick:t,children:[e.jsx(pe,{photo:s.photos[0],sizes:"(max-width: 768px) 100vw, 50vw",className:"w-full h-40 object-cover"}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("span",{className:"flex items-center justify-center w-7 h-7 bg-red-600 text-white rounded-full font-bold text-sm shadow-md",children:r})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 truncate flex-1 mr-2",children:s.name}),e.jsx(Xe,{shop:s,size:"medium"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx(D,{className:"w-4 h-4 text-yellow-500 dark:text-yellow-400 mr-1 flex-shrink-0",fill:"currentColor"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400 mr-2",children:s.rating.toFixed(1)}),e.jsx("span",{className:"mr-2",children:"·"}),e.jsx(G,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ae,{className:"w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500"}),s.accessInfo]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500"}),"約 ",Math.round(s.distance),"m"]}),e.jsx(Qe,{status:s.congestion})]})]})]})})]}),s.reviews&&s.reviews.length>0&&e.jsxs("div",{className:"px-4 pt-3 pb-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"最新のレビュー"}),e.jsx(me,{review:s.reviews[0]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 space-y-2",children:R.map((N,z)=>e.jsx(me,{review:N},z))}),C>1&&e.jsxs("div",{className:"flex justify-between items-center mt-3 text-sm",children:[e.jsxs("button",{onClick:N=>{N.stopPropagation(),f(z=>z-1)},disabled:j===0,className:"flex items-center p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"前へ"})]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-semibold",children:[j+1," / ",C]}),e.jsxs("button",{onClick:N=>{N.stopPropagation(),f(z=>z+1)},disabled:j>=C-1,className:"flex items-center p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx("span",{className:"hidden sm:inline",children:"次へ"}),e.jsx(ne,{className:"w-5 h-5"})]})]})]}),s.reviews.length>1&&e.jsxs("button",{onClick:$,className:"w-full mt-2 text-center text-red-600 dark:text-red-500 font-semibold text-sm hover:text-red-800 dark:hover:text-red-400 flex items-center justify-center",children:[g?"レビューを閉じる":`他のレビュー${s.reviews.length-1}件を表示`,e.jsx(te,{className:`w-5 h-5 ml-1 transition-transform ${g?"rotate-180":""}`})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("button",{onClick:E,className:"w-full text-red-600 dark:text-red-500 font-semibold text-sm hover:text-red-800 dark:hover:text-red-400 flex items-center justify-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),c?"AI要約を閉じる":"AIによるクチコミ要約を見る",e.jsx(te,{className:`w-5 h-5 ml-1 transition-transform ${c?"rotate-180":""}`})]}),c&&e.jsx("div",{className:"mt-3",children:e.jsx(fe,{placeId:s.placeId,reviews:s.reviews})})]}),s.keywords&&s.keywords.length>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 px-4 py-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.keywords.slice(0,4).map(N=>e.jsx("span",{className:"text-xs bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300 px-2 py-1 rounded-full",children:N},N))})})]})},ae=W.memo(Ze),es=(s,t)=>{const r="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors";return s===t?`${r} border-red-500 text-red-600 dark:text-red-500`:`${r} border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-600`},ss=(s,t)=>{const r="ml-2 rounded-full px-2 py-0.5 text-xs font-semibold";return s===t?`${r} bg-red-100 text-red-600 dark:bg-red-900/50 dark:text-red-400`:`${r} bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300`},ts=({bookmarkedShops:s,visitedShops:t,userPosts:r,onShopSelect:m})=>{const[i,b]=x.useState("bookmarks"),[d,n]=x.useState([]),[g,o]=x.useState(!0);x.useEffect(()=>{c()},[]);const c=async()=>{try{o(!0);const a=await B.getFavoritesSorted("recent");n(a)}catch(a){console.error("Error loading favorites:",a)}finally{o(!1)}},y=[{id:"bookmarks",label:"気になる",icon:e.jsx(he,{className:"w-5 h-5"}),count:s.length},{id:"visited",label:"訪問済み",icon:e.jsx(se,{className:"w-5 h-5"}),count:t.length},{id:"favorites",label:"お気に入り",icon:e.jsx(U,{className:"w-5 h-5"}),count:d.length},{id:"posts",label:"自分の投稿",icon:e.jsx(xe,{className:"w-5 h-5"}),count:r.length}],j=a=>e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white cursor-pointer hover:text-red-600",onClick:()=>m({placeId:a.placeId,name:a.name,address:a.address,rating:a.rating}),children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:a.address}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),a.rating.toFixed(1)]}),a.visitCount&&a.visitCount>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),a.visitCount,"回訪問"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),a.savedAt.toLocaleDateString("ja-JP")]})]}),a.personal_notes&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded text-sm",children:[e.jsx(Le,{className:"w-4 h-4 inline mr-1"}),a.personal_notes]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:a.tags.map((u,C)=>e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:u},C))})]}),e.jsx("div",{className:"ml-4 text-red-500",children:e.jsx(U,{className:"w-6 h-6 fill-current"})})]})},a.placeId),f=()=>{switch(i){case"bookmarks":return e.jsx("div",{className:"space-y-4",children:s.length>0?s.map((a,u)=>e.jsx(ae,{shop:a,index:u+1,onSelect:()=>m(a),isHovered:!1,isHighlighted:!1,onMouseEnter:()=>{},onMouseLeave:()=>{}},a.placeId)):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"まだ気になるお店がありません。"})});case"visited":return e.jsx("div",{className:"space-y-4",children:t.length>0?t.map((a,u)=>e.jsx(ae,{shop:a,index:u+1,onSelect:()=>m(a),isHovered:!1,isHighlighted:!1,onMouseEnter:()=>{},onMouseLeave:()=>{}},a.placeId)):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"まだ訪問したお店がありません。"})});case"favorites":return g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"お気に入りを読み込み中..."})]}):e.jsx("div",{className:"space-y-4",children:d.length>0?d.map(j):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"まだお気に入りのお店がありません。"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"お店の詳細ページでハートをタップしてお気に入りに追加しましょう。"})]})});case"posts":return e.jsx("div",{className:"space-y-4",children:r.length>0?r.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx(pe,{photo:a.image,sizes:"(max-width: 768px) 100vw, 50vw",className:"w-full h-40 object-cover rounded-md mb-3"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200",children:a.comment}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:a.createdAt})]},a.postId)):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"まだ投稿がありません。"})})}};return e.jsxs("div",{className:"animate-fade-in p-4",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:e.jsx("nav",{className:"-mb-px flex space-x-4 overflow-x-auto","aria-label":"Tabs",children:y.map(a=>e.jsxs("button",{onClick:()=>b(a.id),className:es(a.id,i),children:[a.icon,e.jsx("span",{className:"ml-2 whitespace-nowrap",children:a.label}),e.jsx("span",{className:ss(a.id,i),children:a.count})]},a.id))})}),f()]})},bs=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"})),as=()=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden animate-pulse",children:[e.jsx("div",{className:"w-full h-40 bg-gray-300 dark:bg-gray-700"}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"w-7 h-7 bg-gray-300 dark:bg-gray-700 rounded-full"})}),e.jsxs("div",{className:"flex-grow min-w-0 space-y-2",children:[e.jsx("div",{className:"h-5 w-3/4 bg-gray-300 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-full bg-gray-200 dark:bg-gray-600 rounded"}),e.jsxs("div",{className:"flex gap-4 pt-1",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-gray-200 dark:bg-gray-600 rounded"})]})]})]})}),e.jsxs("div",{className:"px-4 pt-3 pb-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"h-3 w-1/4 bg-gray-200 dark:bg-gray-600 rounded mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 w-1/2 bg-gray-200 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-3 w-full bg-gray-200 dark:bg-gray-600 rounded"})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:"h-5 w-1/2 mx-auto bg-gray-200 dark:bg-gray-600 rounded-full"})})]});let Q=null,H=null;async function be(s,t=["places"]){const r=s||"";if(!r)throw new Error("Missing VITE_GOOGLE_MAPS_API_KEY. Please set your Google Maps API key in .env.local");return H||(Q||(Q=new Ue({apiKey:r,version:"weekly",libraries:t})),H=Q.load(),H)}const rs=["醤油","豚骨","家系","味噌","担々麺","鶏白湯","煮干","昆布水","貝出汁","鴨出汁","二郎"],ns=["ラーメン","ラーメン屋","拉麺","ramen","中華そば","麺","らーめん","麺処","麺屋","麺ダイニング","家系","鶏soba","らー麺","中華蕎麦","らぁ麺","らぁめん","麺や","えびそば","麺堂","麺匠","麺宿","つけ麺","鶏そば","Ramen","SOBA","油そば","製麺","タンメン","担々麺","鯛塩そば","つけめん","支那そば","まぜそば","Noodle","ラー麺"],ls=["洋食","居酒屋","イタリアン","フレンチ","カフェ","coffee","レストラン","bistro","brasserie","trattoria","osteria","うどん","蕎麦","そば","スパゲッティ","パスタ","ピザ","pizza","バー","bar","焼肉","yakiniku","寿司","sushi","天ぷら","tempura","定食","teishoku"],Z={strong:["ラーメン","拉麺","ramen","中華そば","つけ麺","油そば","混ぜそば","二郎","家系","豚骨","味噌","醤油","塩ラーメン"],medium:["麺","そば","noodle","メン","麺屋","らーめん"],weak:["チャーシュー","替え玉","煮卵","もやし","のり","背脂"]},is=s=>{const t=s.name||"",r=s.vicinity||"",m=s.types||[],i=`${t} ${r} ${m.join(" ")}`.toLowerCase();if(ls.some(c=>i.includes(c.toLowerCase())))return{isRamenShop:!1,confidence:.9,reason:"exclude_keyword_found"};let d=0;const n=[];Z.strong.forEach(c=>{i.includes(c.toLowerCase())&&(d+=10,n.push(`strong:${c}`))}),Z.medium.forEach(c=>{i.includes(c.toLowerCase())&&(d+=5,n.push(`medium:${c}`))}),Z.weak.forEach(c=>{i.includes(c.toLowerCase())&&(d+=2,n.push(`weak:${c}`))}),(m.includes("restaurant")||m.includes("meal_takeaway"))&&(d+=3);const g=Math.min(d/10,1),o=d>=5;return console.log(`${t}: score=${d}, confidence=${g}, indicators=[${n.join(",")}]`),{isRamenShop:o,confidence:g,reason:n.length>0?n.join(","):"no_indicators"}},ge=s=>{const t=[[{name:"醤油ラーメン",price:"800円"},{name:"味玉ラーメン",price:"950円"},{name:"チャーシューメン",price:"1,200円"},{name:"餃子 (5個)",price:"450円"},{name:"ライス",price:"150円"}],[{name:"豚骨ラーメン",price:"900円"},{name:"特製ラーメン",price:"1,100円"},{name:"チャーシュー丸",price:"350円"},{name:"キムチ",price:"200円"},{name:"替え玉",price:"100円"},{name:"瓶ビール",price:"600円"}],[{name:"味噌ラーメン",price:"850円"},{name:"野菜ラーメン",price:"1,000円"},{name:"コーンバター",price:"100円"},{name:"もやし",price:"200円"}]],r=s.split("").reduce((m,i)=>m+i.charCodeAt(0),0);return t[r%t.length]},os=({onShopSelect:s,searchTerm:t,setSearchTerm:r,sortKey:m,setSortKey:i,soupTypeFilter:b,setSoupTypeFilter:d,filterOpenNow:n,setFilterOpenNow:g,shops:o,setShops:c,isLocating:y,setIsLocating:j,isFiltering:f,setIsFiltering:a,userLocation:u,hoveredPlaceId:C,setHoveredPlaceId:R,highlightedPlaceId:$,setHighlightedPlaceId:E})=>{const[N,z]=x.useState(null),q=x.useRef(null),O=x.useRef(null),K=x.useRef([]),le=x.useRef({});x.useEffect(()=>{(async()=>{try{await be(),window.google&&window.google.maps&&!N&&z(new window.google.maps.Geocoder)}catch(h){console.error("Failed to load Google Maps API:",h),alert("Google Maps APIの読み込みに失敗しました。APIキーを確認してください。")}})()},[N]),x.useEffect(()=>{q.current&&!O.current&&window.google&&(O.current=new window.google.maps.Map(q.current,{center:u.current||{lat:35.681236,lng:139.767125},zoom:14,mapId:"281e9bf8d5a1aa29156aabcf",disableDefaultUI:!0}),O.current.addListener("click",()=>{E(null)}))},[]),x.useEffect(()=>{if(O.current&&(K.current.forEach(l=>l.setMap(null)),K.current=[],o.length>0)){o.forEach((h,S)=>{if(h.lat&&h.lng){const k=C===h.placeId||$===h.placeId,M=new window.google.maps.Marker({position:{lat:h.lat,lng:h.lng},map:O.current,title:h.name,label:`${S+1}`,zIndex:k?1e3:1,animation:k?window.google.maps.Animation.BOUNCE:null});k&&setTimeout(()=>{M.setAnimation(null)},2100),M.addListener("click",()=>{const I=$===h.placeId?null:h.placeId;if(E(I),I){const v=le.current[h.placeId];v&&v.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}),K.current.push(M)}});const l=new window.google.maps.LatLngBounds;o.forEach(h=>{h.lat&&h.lng&&l.extend({lat:h.lat,lng:h.lng})}),O.current.fitBounds(l)}},[o,C,$,E]);const ie=x.useCallback((l,h,S,k)=>{const I=l*Math.PI/180,v=S*Math.PI/180,_=(S-l)*Math.PI/180,p=(k-h)*Math.PI/180,w=Math.sin(_/2)*Math.sin(_/2)+Math.cos(I)*Math.cos(v)*Math.sin(p/2)*Math.sin(p/2);return 6371e3*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},[]),oe=x.useCallback(async(l,h)=>{const S=new Map,k=[],M=ns.map(async v=>{const _={location:l,radius:300,keyword:v,type:"restaurant"};try{const p=await new Promise(w=>{h.nearbySearch(_,(L,T)=>{T===google.maps.places.PlacesServiceStatus.OK&&L?w(L):w([])})});return{keyword:v,results:p||[]}}catch(p){return console.warn(`Search failed for keyword: ${v}`,p),{keyword:v,results:[]}}});return(await Promise.all(M)).forEach(({keyword:v,results:_})=>{_.forEach(p=>{if(p.place_id&&!S.has(p.place_id)){const w=is(p);w.isRamenShop&&w.confidence>=.5?S.set(p.place_id,{...p,evaluation:w,searchKeyword:v}):k.push(`${p.name} (${w.reason}, confidence: ${w.confidence.toFixed(2)})`)}})}),console.log("Smart filtering results:"),console.log(`- Accepted: ${S.size} ramen shops`),console.log(`- Rejected: ${k.length} non-ramen places`),k.length>0&&console.log(`- Rejected places: ${k.slice(0,5).join(", ")}${k.length>5?"...":""}`),Array.from(S.values())},[]),ce=l=>{if(!l||!l.periods)return!1;const h=new Date,S=h.getDay(),k=h.getHours()*100+h.getMinutes();for(const M of l.periods)if(M.open.day===S){const I=parseInt(M.open.time,10);if(!M.close)return!0;const v=parseInt(M.close.time,10);if(I<=k&&k<v)return!0}return!1},ye=async()=>{if(!navigator.geolocation){alert("お使いのブラウザは位置情報機能に対応していません。");return}j(!0),a(!0),r("現在地周辺");try{const l=await new Promise((I,v)=>{navigator.geolocation.getCurrentPosition(I,v)}),{latitude:h,longitude:S}=l.coords;if(u.current={lat:h,lng:S},!window.google||!window.google.maps||!window.google.maps.places)throw new Error("Google Maps API is not loaded.");const k=new window.google.maps.places.PlacesService(document.createElement("div")),M=await oe(u.current,k);if(console.log("Comprehensive search results:",M),M&&M.length>0){const I=M.map(_=>new Promise(p=>{if(!_.place_id){p(null);return}k.getDetails({placeId:_.place_id,fields:["name","rating","formatted_address","geometry","opening_hours","website","photos","reviews","types","formatted_phone_number","vicinity"]},(w,L)=>{if(L===google.maps.places.PlacesServiceStatus.OK&&w){const T=w.geometry?.location?.lat(),F=w.geometry?.location?.lng(),V=T&&F&&u.current?ie(u.current.lat,u.current.lng,T,F):0,Y=w.photos&&w.photos.length>0?w.photos.slice(0,4).map((P,we)=>({small:P.getUrl({maxWidth:400,maxHeight:300}),medium:P.getUrl({maxWidth:800,maxHeight:600}),large:P.getUrl({maxWidth:1200,maxHeight:900}),alt:`${w.name||""} - ${we+1}`})):[{small:"https://picsum.photos/seed/ramen-default/400/300",medium:"https://picsum.photos/seed/ramen-default/800/600",large:"https://picsum.photos/seed/ramen-default/1200/900",alt:w.name||"ラーメン店"}],A={placeId:w.place_id||`temp-${Math.random().toString(36).substring(2,15)}`,name:w.name||"",photos:Y,rating:w.rating||0,address:w.formatted_address||"",lat:T||0,lng:F||0,hours:w.opening_hours?.weekday_text?.join(`
`)||"営業時間情報なし",website:w.website||"",reviews:w.reviews?.map(P=>({author:P.author_name||"",text:P.text||"",rating:P.rating||0,time:P.time,relative_time_description:P.relative_time_description}))||[],distance:V,keywords:w.types||[],isOpenNow:ce(w.opening_hours),congestion:"不明",accessInfo:"",menu:ge(w.place_id||""),parkingInfo:"近隣コインパーキングあり"};p(A)}else p(null)})})),v=(await Promise.all(I)).filter(_=>_!==null);c(v.sort((_,p)=>_.distance-p.distance))}else console.warn("No search results found"),c([])}catch(l){console.error("An error occurred:",l),alert("検索中にエラーが発生しました。"),c([])}finally{j(!1),a(!1)}},je=async()=>{if(!N||!window.google||!window.google.maps.places){alert("Google Maps APIがロードされていません。");return}a(!0);try{const l=await new Promise(M=>{N.geocode({address:t},(I,v)=>{M({results:I||[],status:v})})});if(l.status!==google.maps.GeocoderStatus.OK||!l.results||l.results.length===0)throw new Error("Geocoding failed or returned no results.");const h=l.results[0].geometry.location;u.current={lat:h.lat(),lng:h.lng()};const S=new window.google.maps.places.PlacesService(document.createElement("div")),k=await oe(u.current,S);if(console.log("Comprehensive search results (by area):",k),k&&k.length>0){const M=k.map(v=>new Promise(_=>{if(!v.place_id){_(null);return}S.getDetails({placeId:v.place_id,fields:["name","rating","formatted_address","geometry","opening_hours","website","photos","reviews","types","formatted_phone_number","vicinity"]},(p,w)=>{if(w===google.maps.places.PlacesServiceStatus.OK&&p){const L=p.geometry?.location?.lat(),T=p.geometry?.location?.lng(),F=L&&T&&u.current?ie(u.current.lat,u.current.lng,L,T):0,V=p.photos&&p.photos.length>0?p.photos.slice(0,4).map((A,P)=>({small:A.getUrl({maxWidth:400,maxHeight:300}),medium:A.getUrl({maxWidth:800,maxHeight:600}),large:A.getUrl({maxWidth:1200,maxHeight:900}),alt:`${p.name||""} - ${P+1}`})):[{small:"https://picsum.photos/seed/ramen-default/400/300",medium:"https://picsum.photos/seed/ramen-default/800/600",large:"https://picsum.photos/seed/ramen-default/1200/900",alt:p.name||"ラーメン店"}],Y={placeId:p.place_id||`temp-${Math.random().toString(36).substring(2,15)}`,name:p.name||"",photos:V,rating:p.rating||0,address:p.formatted_address||"",lat:L||0,lng:T||0,hours:p.opening_hours?.weekday_text?.join(`
`)||"営業時間情報なし",website:p.website||"",reviews:p.reviews?.map(A=>({author:A.author_name||"",text:A.text||"",rating:A.rating||0,time:A.time,relative_time_description:A.relative_time_description}))||[],distance:F,keywords:p.types||[],isOpenNow:ce(p.opening_hours),congestion:"不明",accessInfo:"",menu:ge(p.place_id||""),parkingInfo:"近隣コインパーキングあり"};_(Y)}else _(null)})})),I=(await Promise.all(M)).filter(v=>v!==null);c(I.sort((v,_)=>v.distance-_.distance))}else console.warn("No search results found"),c([])}catch(l){console.error("An error occurred during area search:",l),alert("指定された場所が見つかりませんでした。"),c([])}finally{a(!1)}},J=x.useMemo(()=>o.filter(l=>{const h=b===""||l.name.toLowerCase().includes(b.toLowerCase())||l.reviews.some(k=>k.text.toLowerCase().includes(b.toLowerCase())),S=!n||l.isOpenNow;return h&&S}).sort((l,h)=>m==="rating"?h.rating-l.rating:l.distance-h.distance),[o,m,b,n]);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 lg:grid-rows-[auto_1fr] lg:gap-8",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg shadow-md z-10",children:[e.jsxs("button",{onClick:ye,disabled:y,className:"w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed mb-3",children:[e.jsx(ze,{className:`h-5 w-5 mr-2 ${y?"animate-spin":""}`}),y?"現在地を検索中...":"現在地で周囲を検索"]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(G,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 h-5 w-5 pointer-events-none"}),e.jsx("input",{id:"location-search",type:"text",placeholder:"駅名・住所・郵便番号",value:t,onChange:l=>r(l.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-700 rounded-lg shadow-sm focus:ring-2 focus:ring-red-500 transition bg-gray-800 text-white"})]}),e.jsx("button",{onClick:je,className:"w-full bg-gray-700 text-gray-200 font-bold py-3 rounded-lg hover:bg-gray-600 transition shadow-md border border-gray-600",children:"このエリアで検索"})]})}),e.jsx("div",{className:"mt-4 h-64 md:h-80 bg-gray-800 rounded-lg shadow-inner relative overflow-hidden lg:col-span-5 lg:row-span-2 lg:col-start-8 lg:row-start-1 lg:mt-0 lg:sticky lg:top-[100px] lg:h-[calc(100vh-160px)] lg:max-h-[800px] transition-all duration-300",children:e.jsx("div",{ref:q,className:"w-full h-full"})}),e.jsxs("div",{className:"mt-4 lg:col-span-7 lg:row-start-2 lg:max-h-[calc(100vh-200px)] lg:overflow-y-auto lg:pr-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("label",{htmlFor:"soup-type",className:"sr-only",children:"スープの種類"}),e.jsxs("select",{id:"soup-type",value:b,onChange:l=>d(l.target.value),className:"px-3 py-2 border border-gray-700 rounded-md focus:ring-2 focus:ring-red-500 bg-gray-800 text-white transition shadow-sm",children:[e.jsx("option",{value:"",children:"全てのスープ"}),rs.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>g(!n),className:"form-checkbox h-4 w-4 rounded text-red-600 focus:ring-red-500 border-gray-600 bg-gray-700"}),e.jsx("span",{children:"営業中のみ表示"})]})]}),e.jsxs("button",{onClick:()=>i(m==="distance"?"rating":"distance"),className:"flex items-center px-4 py-2 bg-gray-800 border border-gray-700 rounded-full text-sm text-gray-200 hover:bg-gray-700 transition shadow-sm",children:[e.jsx(Oe,{className:"h-4 w-4 mr-1.5"}),m==="distance"?"距離が近い順":"評価が高い順"]})]}),e.jsxs("p",{className:"text-sm text-gray-400 mb-3",children:["検索結果: ",f?"...":`${J.length}件`]}),e.jsx("div",{className:"space-y-4",children:f?Array.from({length:3}).map((l,h)=>e.jsx(as,{},h)):J.length>0?J.map((l,h)=>e.jsx("div",{ref:S=>{le.current[l.placeId]=S},className:"animate-slide-in-bottom",style:{animationDelay:`${h*70}ms`},children:e.jsx(ae,{shop:l,index:h+1,onSelect:()=>s(l),isHovered:C===l.placeId,isHighlighted:$===l.placeId,onMouseEnter:()=>R(l.placeId),onMouseLeave:()=>R(null),onClick:()=>E($===l.placeId?null:l.placeId)})},l.placeId)):e.jsx("div",{className:"text-center py-10 bg-gray-900 rounded-lg shadow-md",children:e.jsx("p",{className:"text-gray-400",children:"条件に合うラーメン屋が見つかりませんでした。"})})})]})]})},ys=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"})),cs=({shop:s,apiKey:t})=>{const r=x.useRef(null),m=x.useRef(null),i=x.useRef(null);return x.useEffect(()=>{if(!t){console.warn("Google Maps API key is not provided");return}const b=async()=>{try{await be(t),window.google&&window.google.maps&&d()}catch(n){console.error("Failed to load Google Maps API:",n)}},d=()=>{if(r.current)try{const n=new google.maps.Map(r.current,{center:{lat:s.lat,lng:s.lng},zoom:16,mapTypeControl:!1,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"simplified"}]}]}),g=new google.maps.Marker({position:{lat:s.lat,lng:s.lng},map:n,title:s.name,animation:google.maps.Animation.DROP,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="#EF4444"/>
                <circle cx="12" cy="9" r="2.5" fill="white"/>
              </svg>
            `),scaledSize:new google.maps.Size(32,32),anchor:new google.maps.Point(16,32)}});m.current=n,i.current=g}catch(n){console.error("Error initializing Google Maps:",n)}};return b(),()=>{i.current&&i.current.setMap(null),m.current=null,i.current=null}},[s,t]),t?e.jsx("div",{className:"w-full h-64 bg-gray-800 rounded-lg overflow-hidden",children:e.jsx("div",{ref:r,className:"w-full h-full"})}):e.jsx("div",{className:"w-full h-64 bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"text-center text-gray-400",children:e.jsx("p",{children:"地図を表示するにはGoogle Maps API キーが必要です"})})})},ds=Object.freeze(Object.defineProperty({__proto__:null,default:cs},Symbol.toStringTag,{value:"Module"}));export{us as F,bs as M,ps as R,ys as S,fs as T,He as _,hs as a};
