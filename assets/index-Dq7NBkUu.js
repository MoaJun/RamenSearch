const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RamenShopDetail-Da1LbrLU.js","assets/ui-D1brmElj.js","assets/vendor-D3F3s8fL.js","assets/ReviewSummary-B4aI4XXt.js","assets/ai-8rzRUgYl.js","assets/MyPage-BLBj1JDJ.js","assets/RamenShopListItem-DSriu-Ab.js","assets/SearchPage-1U4Gp4kz.js","assets/googleMaps-dUlr1ba2.js","assets/google-maps-93e-Jyro.js"])))=>i.map(i=>d[i]);
import{r as Ee,a as ke,g as je}from"./vendor-D3F3s8fL.js";import{M as Te,r as i,X as ae,I as Ne,L as Fe,S as Me,C as Ce,R as P,H as Oe,U as Re}from"./ui-D1brmElj.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var J={exports:{}},C={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function Ae(){if(oe)return C;oe=1;var n=Ee(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,d,h){var p,m={},f=null,w=null;h!==void 0&&(f=""+h),d.key!==void 0&&(f=""+d.key),d.ref!==void 0&&(w=d.ref);for(p in d)s.call(d,p)&&!o.hasOwnProperty(p)&&(m[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:e,type:u,key:f,ref:w,props:m,_owner:r.current}}return C.Fragment=t,C.jsx=l,C.jsxs=l,C}var ie;function Ve(){return ie||(ie=1,J.exports=Ae()),J.exports}var a=Ve(),V={},ne;function $e(){if(ne)return V;ne=1;var n=ke();return V.createRoot=n.createRoot,V.hydrateRoot=n.hydrateRoot,V}var Ue=$e();const Pe=je(Ue),Le="modulepreload",qe=function(n){return"/"+n},ce={},Y=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let l=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),d=u?.nonce||u?.getAttribute("nonce");r=l(t.map(h=>{if(h=qe(h),h in ce)return;ce[h]=!0;const p=h.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":Le,p||(f.as="script"),f.crossOrigin="",f.href=h,d&&f.setAttribute("nonce",d),document.head.appendChild(f),p)return new Promise((w,k)=>{f.addEventListener("load",w),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return r.then(l=>{for(const u of l||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},Be=[{placeId:"ch-1",name:"麺屋 龍の心 (Menya Ryunoshin)",photos:[{small:"https://picsum.photos/seed/ramen1-main/400/300",medium:"https://picsum.photos/seed/ramen1-main/800/600",large:"https://picsum.photos/seed/ramen1-main/1200/900",alt:"龍の心ラーメン"},{small:"https://picsum.photos/seed/ramen1-side/400/300",medium:"https://picsum.photos/seed/ramen1-side/800/600",large:"https://picsum.photos/seed/ramen1-side/1200/900",alt:"サイドメニューの餃子"},{small:"https://picsum.photos/seed/ramen1-shop/400/300",medium:"https://picsum.photos/seed/ramen1-shop/800/600",large:"https://picsum.photos/seed/ramen1-shop/1200/900",alt:"店舗の外観"},{small:"https://picsum.photos/seed/ramen1-noodles/400/300",medium:"https://picsum.photos/seed/ramen1-noodles/800/600",large:"https://picsum.photos/seed/ramen1-noodles/1200/900",alt:"ラーメンの麺"}],rating:4.5,address:"東京都新宿区西新宿1-1-1",lat:35.690921,lng:139.700257,hours:"11:00 - 22:00",website:"https://example.com/ryunoshin",twitterUrl:"https://twitter.com/example_ramen",reviews:[{author:"佐藤健",text:"濃厚な豚骨スープが絶品！チャーシューがとろけるように柔らかく、替え玉必須です。行列が絶えないのも納得。",rating:5,relative_time_description:"1週間前",time:1705276800},{author:"鈴木一郎",text:"こってり好きにはたまらない一杯。麺の硬さも選べて最高でした。ニンニクをたっぷり入れるのがおすすめ。",rating:4,relative_time_description:"2週間前",time:1704672e3},{author:"高橋花子",text:"スープは美味しかったですが、少し味が濃すぎると感じました。店内の活気は良かったです。",rating:3,relative_time_description:"3週間前",time:1704067200},{author:"田中守",text:"週末のランチタイムはかなり混雑します。時間をずらしていくのが吉。",rating:4,relative_time_description:"1ヶ月前",time:1702684800},{author:"伊藤由美",text:"卓上の高菜が無料で食べ放題なのが嬉しい。ラーメンとの相性も抜群。",rating:5,relative_time_description:"1ヶ月前",time:170208e4},{author:"渡辺明",text:"店員さんの接客がとても丁寧で気持ちが良い。味だけでなく、サービスも素晴らしい。",rating:5,relative_time_description:"2ヶ月前",time:1699401600},{author:"山本さくら",text:"麺の量は標準的。たくさん食べる人は大盛りか替え玉を検討すると良いかも。",rating:4,relative_time_description:"2ヶ月前",time:1698796800},{author:"中村健太",text:"黒マー油が入った「黒龍ラーメン」も香ばしくておすすめ。",rating:5,relative_time_description:"3ヶ月前",time:1696118400},{author:"小林直子",text:"お店はカウンター席のみなので、大人数での訪問には向きません。一人か二人で行くのがベスト。",rating:3,relative_time_description:"3ヶ月前",time:1695513600},{author:"加藤浩二",text:"何度来ても飽きない味。これぞ王道の豚骨ラーメン。",rating:5,relative_time_description:"4ヶ月前",time:1692835200}],distance:250,keywords:["豚骨","こってり","行列"],isOpenNow:!0,congestion:"混雑",accessInfo:"JR新宿駅西口から徒歩5分",menu:[{name:"特製龍の心ラーメン",price:"1,100円"},{name:"味玉ラーメン",price:"950円"},{name:"チャーシュー丼",price:"350円"},{name:"餃子 (5個)",price:"450円"},{name:"ライス",price:"150円"},{name:"瓶ビール",price:"600円"}],parkingInfo:"近隣にコインパーキング多数有り（提携なし）"},{placeId:"ch-2",name:"鶏そば 白鷺 (Torisoba Shirasagi)",photos:[{small:"https://picsum.photos/seed/ramen2-main/400/300",medium:"https://picsum.photos/seed/ramen2-main/800/600",large:"https://picsum.photos/seed/ramen2-main/1200/900",alt:"鶏そば"},{small:"https://picsum.photos/seed/ramen2-side/400/300",medium:"https://picsum.photos/seed/ramen2-side/800/600",large:"https://picsum.photos/seed/ramen2-side/1200/900",alt:"鶏ハム"},{small:"https://picsum.photos/seed/ramen2-shop/400/300",medium:"https://picsum.photos/seed/ramen2-shop/800/600",large:"https://picsum.photos/seed/ramen2-shop/1200/900",alt:"白鷺の店舗内観"}],rating:4.8,address:"東京都渋谷区道玄坂2-2-2",lat:35.658034,lng:139.699998,hours:"11:30 - 15:00, 17:30 - 21:00",website:"https://example.com/shirasagi",twitterUrl:"https://twitter.com/example_ramen2",reviews:[{author:"田中美咲",text:"鶏の旨味が凝縮されたスープは、あっさりしているのに奥深い。細麺との相性も抜群。女性一人でも入りやすい雰囲気です。",rating:5,relative_time_description:"3日前",time:1705536e3},{author:"伊藤大輔",text:"非常に上品な味わいのラーメン。チャーシューの代わりに鶏ハムが乗っていてヘルシー。スープを最後まで飲み干してしまった。",rating:5,relative_time_description:"1週間前",time:1705104e3},{author:"渡辺あきら",text:"限定の柚子塩そばが最高でした。",rating:5,relative_time_description:"2週間前",time:1704499200},{author:"中村さやか",text:"店内がとても綺麗で快適でした。",rating:4,relative_time_description:"3週間前",time:1703894400},{author:"小林太郎",text:"麺の量が少し少なめに感じました。",rating:3,relative_time_description:"1ヶ月前",time:1702512e3},{author:"斉藤一",text:"リピート確定です。次はつけ麺を試したい。",rating:5,relative_time_description:"2ヶ月前",time:1699228800}],distance:480,keywords:["鶏白湯","あっさり","上品"],isOpenNow:!1,congestion:"不明",accessInfo:"JR渋谷駅ハチ公口から徒歩7分",menu:[{name:"特製鶏そば（塩）",price:"1,200円"},{name:"鶏そば（醤油）",price:"900円"},{name:"鶏白湯つけ麺",price:"1,000円"}],parkingInfo:"駐車場なし。渋谷駅周辺の駐車場をご利用ください。"},{placeId:"ch-3",name:"味噌の極み (Miso no Kiwami)",photos:[{small:"https://picsum.photos/seed/ramen3-main/400/300",medium:"https://picsum.photos/seed/ramen3-main/800/600",large:"https://picsum.photos/seed/ramen3-main/1200/900",alt:"味噌ラーメン"},{small:"https://picsum.photos/seed/ramen3-side/400/300",medium:"https://picsum.photos/seed/ramen3-side/800/600",large:"https://picsum.photos/seed/ramen3-side/1200/900",alt:"バターコーンのトッピング"},{small:"https://picsum.photos/seed/ramen3-shop/400/300",medium:"https://picsum.photos/seed/ramen3-shop/800/600",large:"https://picsum.photos/seed/ramen3-shop/1200/900",alt:"味噌の極みの店舗"},{small:"https://picsum.photos/seed/ramen3-gyoza/400/300",medium:"https://picsum.photos/seed/ramen3-gyoza/800/600",large:"https://picsum.photos/seed/ramen3-gyoza/1200/900",alt:"サイドの餃子"}],rating:4.2,address:"東京都豊島区東池袋3-3-3",lat:35.729458,lng:139.710348,hours:"11:00 - 23:00",website:"https://example.com/kiwami",reviews:[{author:"渡辺直樹",text:"北海道出身者も唸る本格味噌ラーメン。炒めた野菜の香ばしさがスープに溶け込んでいて最高。太ちぢれ麺がスープによく絡む。",rating:5,relative_time_description:"5日前",time:1705363200},{author:"山本由美",text:"バターとコーンをトッピングするのが定番。味が濃いめなので、ライスと一緒に食べるのがおすすめです。体が温まります。",rating:4,relative_time_description:"1週間前",time:1704931200}],distance:800,keywords:["味噌","濃厚","北海道"],isOpenNow:!0,congestion:"普通",accessInfo:"JR池袋駅東口から徒歩10分",menu:[{name:"極み味噌ラーメン",price:"980円"},{name:"辛味噌ラーメン",price:"1,050円"},{name:"餃子セット",price:"400円"}],parkingInfo:"店舗裏に提携コインパーキング有り（200円割引）"},{placeId:"ch-4",name:"煮干し中華そば 凪 (Niboshi Chuukasoba Nagi)",photos:[{small:"https://picsum.photos/seed/ramen4-main/400/300",medium:"https://picsum.photos/seed/ramen4-main/800/600",large:"https://picsum.photos/seed/ramen4-main/1200/900",alt:"すごい煮干ラーメン"},{small:"https://picsum.photos/seed/ramen4-shop/400/300",medium:"https://picsum.photos/seed/ramen4-shop/800/600",large:"https://picsum.photos/seed/ramen4-shop/1200/900",alt:"凪の店舗"}],rating:4.3,address:"東京都千代田区丸の内4-4-4",lat:35.681236,lng:139.767125,hours:"10:30 - 22:00",website:"https://example.com/nagi",reviews:[{author:"中村拓也",text:"煮干しのパンチがすごい！好きな人はとことんハマる味。最初は驚くけど、だんだんクセになってくる。",rating:4,relative_time_description:"2日前",time:1705622400},{author:"小林さやか",text:"煮干しの風味がガツンときます。麺は太めで食べ応えあり。好みが分かれる味かもしれませんが、私は大好きです。",rating:5,relative_time_description:"4日前",time:1705449600}],distance:150,keywords:["煮干","醤油","個性的"],isOpenNow:!0,congestion:"空席あり",accessInfo:"東京メトロ大手町駅直結",menu:[{name:"すごい煮干ラーメン",price:"900円"},{name:"塩煮干ラーメン",price:"900円"},{name:"いったん麺",price:"150円"}],parkingInfo:"ビル地下駐車場利用可能（有料）"}],He=({onOpen:n})=>a.jsx("button",{onClick:n,className:"fixed bottom-5 right-5 z-50 flex items-center justify-center w-14 h-14 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-gray-900","aria-label":"フィードバックを送信",children:a.jsx(Te,{className:"w-7 h-7"})}),Je=({isOpen:n,onClose:e,onSubmit:t})=>{const[s,r]=i.useState("suggestion"),[o,l]=i.useState(""),[u,d]=i.useState(null),[h,p]=i.useState(!1),m=i.useRef(null),f=g=>{if(g.target.files&&g.target.files[0]){const _=g.target.files[0],S=new FileReader;S.onload=R=>{d(R.target?.result)},S.readAsDataURL(_)}},w=i.useCallback(()=>{r("suggestion"),l(""),d(null),m.current&&(m.current.value="")},[]),k=async g=>{if(g.preventDefault(),!o.trim()){alert("詳細を入力してください。");return}p(!0);const _={type:s,details:o,screenshot:u||void 0};try{if(!(await fetch("http://localhost:8080/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)})).ok)throw new Error("Server responded with an error");t(_),e()}catch(S){console.error("Failed to submit feedback:",S),alert("フィードバックの送信に失敗しました。後でもう一度お試しください。")}finally{p(!1)}};return i.useEffect(()=>{const g=_=>{_.key==="Escape"&&e()};return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[e]),i.useEffect(()=>{n||setTimeout(()=>{w(),p(!1)},300)},[n,w]),n?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 transition-opacity animate-fade-in-fast",onClick:e,role:"dialog","aria-modal":"true","aria-labelledby":"feedback-modal-title",children:a.jsxs("div",{className:"bg-gray-900 rounded-xl shadow-2xl w-full max-w-md m-4 transform transition-transform animate-slide-in-bottom",onClick:g=>g.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-800",children:[a.jsx("h2",{id:"feedback-modal-title",className:"text-xl font-bold text-white",children:"フィードバックを送信"}),a.jsx("button",{onClick:e,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",children:a.jsx(ae,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:k,children:[a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"フィードバックの種類"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"feedbackType",value:"suggestion",checked:s==="suggestion",onChange:g=>r(g.target.value),className:"form-radio h-4 w-4 text-red-500 bg-gray-800 border-gray-600 focus:ring-red-500"}),a.jsx("span",{className:"text-gray-200",children:"ご意見・ご要望"})]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"feedbackType",value:"bug",checked:s==="bug",onChange:g=>r(g.target.value),className:"form-radio h-4 w-4 text-red-500 bg-gray-800 border-gray-600 focus:ring-red-500"}),a.jsx("span",{className:"text-gray-200",children:"バグ報告"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"details",className:"block text-sm font-medium text-gray-300 mb-2",children:"詳細"}),a.jsx("textarea",{id:"details",value:o,onChange:g=>l(g.target.value),placeholder:"改善点や問題点など、詳しくお聞かせください。",className:"w-full p-3 border border-gray-700 rounded-lg shadow-sm focus:ring-2 focus:ring-red-500 transition bg-gray-800 text-white min-h-[120px]",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"スクリーンショット (任意)"}),u?a.jsxs("div",{className:"relative group",children:[a.jsx("img",{src:u,alt:"Screenshot preview",className:"rounded-lg max-h-40 w-auto"}),a.jsx("button",{type:"button",onClick:()=>{d(null),m.current&&(m.current.value="")},className:"absolute top-2 right-2 bg-black bg-opacity-60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"画像を削除",children:a.jsx(ae,{className:"w-4 h-4"})})]}):a.jsxs("button",{type:"button",onClick:()=>m.current?.click(),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 border-2 border-dashed border-gray-600 rounded-lg text-gray-400 hover:border-gray-500 hover:text-gray-300 transition-colors",children:[a.jsx(Ne,{className:"w-5 h-5"}),a.jsx("span",{children:"クリックして画像を選択"})]}),a.jsx("input",{type:"file",ref:m,onChange:f,className:"hidden",accept:"image/*"})]})]}),a.jsx("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-800 flex justify-end",children:a.jsx("button",{type:"submit",disabled:!o.trim()||h,className:"flex items-center justify-center bg-red-600 text-white font-bold px-6 py-2.5 rounded-lg hover:bg-red-700 transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed w-32",children:h?a.jsx(Fe,{className:"w-5 h-5 animate-spin"}):a.jsxs(a.Fragment,{children:[a.jsx(Me,{className:"w-5 h-5 mr-2"}),a.jsx("span",{children:"送信する"})]})})})]})]})}):null},ze=({message:n,show:e})=>{const[t,s]=i.useState(!1);return i.useEffect(()=>{if(e)s(!0);else{const r=setTimeout(()=>s(!1),300);return()=>clearTimeout(r)}},[e]),t?a.jsxs("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 z-50 flex items-center p-4 mb-4 text-sm font-semibold text-green-100 bg-green-600 rounded-lg shadow-lg transition-all duration-300 ${e?"opacity-100 translate-y-0":"opacity-0 -translate-y-5"}`,role:"alert",children:[a.jsx(Ce,{className:"w-5 h-5 mr-3"}),a.jsx("span",{className:"font-medium",children:n})]}):null};class W{constructor(e="ramensearch_cache"){this.prefix=e}async get(e){try{const t=`${this.prefix}_${e}`,s=localStorage.getItem(t);if(!s)return null;const r=JSON.parse(s);return Date.now()>r.timestamp+r.expiresIn?(localStorage.removeItem(t),null):r.data}catch(t){return console.warn(`Cache get error for key ${e}:`,t),null}}async set(e,t,s=1440*60*1e3){try{const r=`${this.prefix}_${e}`,o={data:t,timestamp:Date.now(),expiresIn:s};localStorage.setItem(r,JSON.stringify(o))}catch(r){if(console.warn(`Cache set error for key ${e}:`,r),r instanceof DOMException&&r.code===22){console.warn("localStorage quota exceeded, clearing old cache"),this.clearExpired();try{const o=`${this.prefix}_${e}`,l={data:t,timestamp:Date.now(),expiresIn:s};localStorage.setItem(o,JSON.stringify(l))}catch(o){console.error("Failed to cache even after cleanup:",o)}}}}async remove(e){const t=`${this.prefix}_${e}`;localStorage.removeItem(t)}async clear(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s?.startsWith(this.prefix)&&e.push(s)}e.forEach(t=>localStorage.removeItem(t))}async clearExpired(){const e=[],t=Date.now();for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r?.startsWith(this.prefix))try{const o=localStorage.getItem(r);if(o){const l=JSON.parse(o);t>l.timestamp+l.expiresIn&&e.push(r)}}catch{e.push(r)}}return e.forEach(s=>localStorage.removeItem(s)),e.length}getStats(){let e=0,t=0;for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r?.startsWith(this.prefix)){e++;const o=localStorage.getItem(r);o&&(t+=r.length+o.length)}}return{totalEntries:e,totalSize:t}}}const at=new W("ramensearch_gemini"),b=new W("ramensearch_favorites"),$=new W("ramensearch_visits"),E="user_favorites",z="user_visits",I=365*24*60*60*1e3;class G{async getFavorites(){const e=await b.get(E);return e?e.map(t=>({...t,savedAt:new Date(t.savedAt),lastVisit:t.lastVisit?new Date(t.lastVisit):void 0})):[]}async addToFavorites(e){const t=await this.getFavorites();if(t.findIndex(o=>o.placeId===e.placeId)!==-1){console.log("Shop is already in favorites");return}const r={placeId:e.placeId,name:e.name,address:e.address,rating:e.rating,savedAt:new Date,visitCount:0};t.push(r),await b.set(E,t,I)}async removeFromFavorites(e){const s=(await this.getFavorites()).filter(r=>r.placeId!==e);await b.set(E,s,I)}async isFavorite(e){return(await this.getFavorites()).some(s=>s.placeId===e)}async updateFavoriteNotes(e,t){const s=await this.getFavorites(),r=s.findIndex(o=>o.placeId===e);if(r===-1)throw new Error("Shop not found in favorites");s[r].personal_notes=t,await b.set(E,s,I)}async updateFavoriteTags(e,t){const s=await this.getFavorites(),r=s.findIndex(o=>o.placeId===e);if(r===-1)throw new Error("Shop not found in favorites");s[r].tags=t,await b.set(E,s,I)}async getVisitHistory(){const e=await $.get(z);return e?e.map(t=>({...t,visitDate:new Date(t.visitDate)})).sort((t,s)=>s.visitDate.getTime()-t.visitDate.getTime()):[]}async addVisit(e){const t=await this.getVisitHistory(),s={...e,visitDate:e.visitDate||new Date};t.unshift(s);const r=t.slice(0,100);await $.set(z,r,I),await this.updateVisitCount(e.placeId)}async updateVisitCount(e){const t=await this.getFavorites(),s=t.findIndex(r=>r.placeId===e);if(s!==-1){const o=(await this.getVisitHistory()).filter(l=>l.placeId===e).length;t[s].visitCount=o,t[s].lastVisit=new Date,await b.set(E,t,I)}}async getShopVisits(e){return(await this.getVisitHistory()).filter(s=>s.placeId===e)}async getFavoritesSorted(e="recent"){const t=await this.getFavorites();switch(e){case"recent":return t.sort((s,r)=>r.savedAt.getTime()-s.savedAt.getTime());case"rating":return t.sort((s,r)=>r.rating-s.rating);case"name":return t.sort((s,r)=>s.name.localeCompare(r.name,"ja"));case"visits":return t.sort((s,r)=>(r.visitCount||0)-(s.visitCount||0));default:return t}}async exportUserData(){const[e,t]=await Promise.all([this.getFavorites(),this.getVisitHistory()]);return{favorites:e,visits:t}}async importUserData(e){e.favorites&&await b.set(E,e.favorites,I),e.visits&&await $.set(z,e.visits,I)}async clearAllData(){await Promise.all([b.clear(),$.clear()])}}const ot=new G;class ue{constructor(){throw this.userId="ramensearch_user",new Error("Supabase configuration missing. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY")}dbFavoriteToApp(e){return{id:e.id,user_id:e.user_id,placeId:e.place_id,name:e.name,address:e.address||"",rating:e.rating||0,savedAt:new Date(e.saved_at),visitCount:e.visit_count,lastVisit:e.last_visit?new Date(e.last_visit):void 0,personal_notes:e.personal_notes||"",tags:e.tags||[],created_at:new Date(e.created_at)}}dbVisitToApp(e){return{id:e.id,user_id:e.user_id,placeId:e.place_id,shop_name:e.shop_name,visitDate:new Date(e.visit_date),rating:e.rating||void 0,notes:e.notes||"",photos:e.photos||[],created_at:new Date(e.created_at)}}async getFavorites(){try{const{data:e,error:t}=await this.supabase.from("favorites").select("*").eq("user_id",this.userId).order("saved_at",{ascending:!1});if(t)throw console.error("Error fetching favorites:",t),t;return(e||[]).map(this.dbFavoriteToApp)}catch(e){return console.error("Failed to get favorites:",e),[]}}async addToFavorites(e){try{if((await supabase.from(TABLES.FAVORITES).select("id").eq("user_id",DEMO_USER_ID).eq("place_id",e.placeId).single()).data){console.log("Shop is already in favorites");return}const s={user_id:DEMO_USER_ID,place_id:e.placeId,name:e.name,address:e.address,rating:e.rating,saved_at:new Date().toISOString(),visit_count:0,last_visit:null,personal_notes:null,tags:null},{error:r}=await supabase.from(TABLES.FAVORITES).insert(s);if(r)throw console.error("Error adding to favorites:",r),r}catch(t){throw console.error("Failed to add to favorites:",t),t}}async removeFromFavorites(e){try{const{error:t}=await supabase.from(TABLES.FAVORITES).delete().eq("user_id",DEMO_USER_ID).eq("place_id",e);if(t)throw console.error("Error removing from favorites:",t),t}catch(t){throw console.error("Failed to remove from favorites:",t),t}}async isFavorite(e){try{const{data:t,error:s}=await supabase.from(TABLES.FAVORITES).select("id").eq("user_id",DEMO_USER_ID).eq("place_id",e).single();return s&&s.code!=="PGRST116"?(console.error("Error checking favorite status:",s),!1):!!t}catch(t){return console.error("Failed to check favorite status:",t),!1}}async updateFavoriteNotes(e,t){try{const{error:s}=await supabase.from(TABLES.FAVORITES).update({personal_notes:t}).eq("user_id",DEMO_USER_ID).eq("place_id",e);if(s)throw console.error("Error updating favorite notes:",s),s}catch(s){throw console.error("Failed to update favorite notes:",s),s}}async updateFavoriteTags(e,t){try{const{error:s}=await supabase.from(TABLES.FAVORITES).update({tags:t}).eq("user_id",DEMO_USER_ID).eq("place_id",e);if(s)throw console.error("Error updating favorite tags:",s),s}catch(s){throw console.error("Failed to update favorite tags:",s),s}}async getVisitHistory(){try{const{data:e,error:t}=await supabase.from(TABLES.VISIT_HISTORY).select("*").eq("user_id",DEMO_USER_ID).order("visit_date",{ascending:!1});if(t)throw console.error("Error fetching visit history:",t),t;return this.transformDatabaseVisitsToApp(e||[])}catch(e){return console.error("Failed to get visit history:",e),[]}}async addVisit(e){try{const t={user_id:DEMO_USER_ID,place_id:e.placeId,shop_name:e.shop_name||"Unknown Shop",visit_date:(e.visitDate||new Date).toISOString(),rating:e.rating||null,notes:e.notes||null,photos:e.photos||null},{error:s}=await supabase.from(TABLES.VISIT_HISTORY).insert(t);if(s)throw console.error("Error adding visit:",s),s;await this.updateVisitCount(e.placeId)}catch(t){throw console.error("Failed to add visit:",t),t}}async getShopVisits(e){try{const{data:t,error:s}=await supabase.from(TABLES.VISIT_HISTORY).select("*").eq("user_id",DEMO_USER_ID).eq("place_id",e).order("visit_date",{ascending:!1});return s?(console.error("Error fetching shop visits:",s),[]):this.transformDatabaseVisitsToApp(t||[])}catch(t){return console.error("Failed to get shop visits:",t),[]}}async getFavoritesSorted(e="recent"){try{let t,s=!1;switch(e){case"recent":t="saved_at";break;case"rating":t="rating";break;case"name":t="name",s=!0;break;case"visits":t="visit_count";break;default:t="saved_at"}const{data:r,error:o}=await supabase.from(TABLES.FAVORITES).select("*").eq("user_id",DEMO_USER_ID).order(t,{ascending:s});return o?(console.error("Error fetching sorted favorites:",o),[]):this.transformDatabaseFavoritesToApp(r||[])}catch(t){return console.error("Failed to get sorted favorites:",t),[]}}async updateVisitCount(e){try{const{count:t,error:s}=await supabase.from(TABLES.VISIT_HISTORY).select("*",{count:"exact",head:!0}).eq("user_id",DEMO_USER_ID).eq("place_id",e);if(s){console.error("Error counting visits:",s);return}const{error:r}=await supabase.from(TABLES.FAVORITES).update({visit_count:t||0,last_visit:new Date().toISOString()}).eq("user_id",DEMO_USER_ID).eq("place_id",e);r&&console.error("Error updating visit count:",r)}catch(t){console.error("Failed to update visit count:",t)}}transformDatabaseFavoritesToApp(e){return e.map(t=>({id:t.id,user_id:t.user_id,placeId:t.place_id,name:t.name,address:t.address,rating:t.rating,savedAt:new Date(t.saved_at),personal_notes:t.personal_notes||void 0,visitCount:t.visit_count,lastVisit:t.last_visit?new Date(t.last_visit):void 0,tags:t.tags||void 0,created_at:new Date(t.created_at)}))}transformDatabaseVisitsToApp(e){return e.map(t=>({id:t.id,user_id:t.user_id,placeId:t.place_id,shop_name:t.shop_name,visitDate:new Date(t.visit_date),rating:t.rating||void 0,notes:t.notes||void 0,photos:t.photos||void 0,created_at:new Date(t.created_at)}))}async exportUserData(){const[e,t]=await Promise.all([this.getFavorites(),this.getVisitHistory()]);return{favorites:e,visits:t}}async clearAllData(){try{await Promise.all([supabase.from(TABLES.FAVORITES).delete().eq("user_id",DEMO_USER_ID),supabase.from(TABLES.VISIT_HISTORY).delete().eq("user_id",DEMO_USER_ID)])}catch(e){throw console.error("Failed to clear user data:",e),e}}}new ue;class Ke{constructor(){this.localService=new G,this.supabaseService=new ue}async migrateToSupabase(){const e={success:!1,favoritesMigrated:0,visitsMigrated:0,errors:[]};try{console.log("Starting data migration from localStorage to Supabase...");const t=await this.localService.exportUserData();if(!t.favorites.length&&!t.visits.length)return console.log("No local data found to migrate"),e.success=!0,e;console.log(`Found ${t.favorites.length} favorites and ${t.visits.length} visits to migrate`);for(const s of t.favorites)try{await this.migrateFavorite(s),e.favoritesMigrated++}catch(r){const o=`Failed to migrate favorite ${s.name}: ${r}`;console.error(o),e.errors.push(o)}for(const s of t.visits)try{await this.migrateVisit(s),e.visitsMigrated++}catch(r){const o=`Failed to migrate visit for ${s.placeId}: ${r}`;console.error(o),e.errors.push(o)}return e.success=e.errors.length===0,console.log("Migration completed:",{favoritesMigrated:e.favoritesMigrated,visitsMigrated:e.visitsMigrated,errors:e.errors.length}),e}catch(t){const s=`Migration failed: ${t}`;return console.error(s),e.errors.push(s),e}}async isMigrationNeeded(){try{const e=await this.localService.exportUserData();if(!e.favorites.length&&!e.visits.length)return!1;const t=await this.supabaseService.exportUserData();return!(t.favorites.length>0||t.visits.length>0)}catch(e){return console.error("Error checking migration status:",e),!1}}async createBackup(){try{return await this.supabaseService.exportUserData()}catch(e){throw console.error("Failed to create backup:",e),e}}async restoreFromBackup(e){try{await this.supabaseService.clearAllData();for(const t of e.favorites)await this.migrateFavorite(t);for(const t of e.visits)await this.migrateVisit(t);console.log("Data restored from backup successfully")}catch(t){throw console.error("Failed to restore from backup:",t),t}}async compareData(){try{const[e,t]=await Promise.all([this.localService.exportUserData(),this.supabaseService.exportUserData()]),s={local:{favorites:e.favorites.length,visits:e.visits.length},supabase:{favorites:t.favorites.length,visits:t.visits.length},differences:[]};return s.local.favorites!==s.supabase.favorites&&s.differences.push(`Favorites count mismatch: local(${s.local.favorites}) vs supabase(${s.supabase.favorites})`),s.local.visits!==s.supabase.visits&&s.differences.push(`Visits count mismatch: local(${s.local.visits}) vs supabase(${s.supabase.visits})`),s}catch(e){throw console.error("Failed to compare data:",e),e}}async migrateFavorite(e){if(await this.supabaseService.isFavorite(e.placeId)){console.log(`Favorite ${e.name} already exists in Supabase, skipping`);return}const s={placeId:e.placeId,name:e.name,address:e.address,rating:e.rating,photos:[],lat:0,lng:0,hours:"",website:"",reviews:[],distance:0,keywords:[],isOpenNow:!1,congestion:"不明",accessInfo:"",menu:[],parkingInfo:""};await this.supabaseService.addToFavorites(s),e.personal_notes&&await this.supabaseService.updateFavoriteNotes(e.placeId,e.personal_notes),e.tags&&e.tags.length>0&&await this.supabaseService.updateFavoriteTags(e.placeId,e.tags)}async migrateVisit(e){await this.supabaseService.addVisit({placeId:e.placeId,shop_name:e.shop_name||"Unknown Shop",visitDate:e.visitDate,rating:e.rating,notes:e.notes,photos:e.photos})}}const N=new Ke,Ye=P.lazy(()=>Y(()=>import("./RamenShopDetail-Da1LbrLU.js"),__vite__mapDeps([0,1,2,3,4]))),We=P.lazy(()=>Y(()=>import("./MyPage-BLBj1JDJ.js"),__vite__mapDeps([5,1,2,6,3,4]))),le=P.lazy(()=>Y(()=>import("./SearchPage-1U4Gp4kz.js"),__vite__mapDeps([7,1,2,6,3,4,8,9])));function Ge(){const[n,e]=i.useState("search"),[t,s]=i.useState(null),[r,o]=i.useState(""),[l,u]=i.useState("distance"),[d,h]=i.useState(""),[p,m]=i.useState(!1),[f,w]=i.useState([]),[k,g]=i.useState(!1),[_,S]=i.useState(!1),[R,X]=i.useState(null),[Q,Z]=i.useState(null),ee=i.useRef(null),[F,me]=i.useState(new Set),[M,he]=i.useState(new Set),[L,ge]=i.useState(new Set),[q,fe]=i.useState([]),[ve,te]=i.useState(!1),[se,re]=i.useState({message:"",show:!1}),B=async(c,v,j)=>{const H=new Set(c);v(x=>{const T=new Set(x);return T.has(j)?T.delete(j):T.add(j),T});try{await new Promise((x,T)=>{setTimeout(()=>{Math.random()>.8?T(new Error("Simulated network error")):x()},500)}),console.log("Update successful for",j)}catch(x){console.error("Optimistic update failed, rolling back:",x),v(H),alert("更新に失敗しました。少し時間をおいて再度お試しください。")}},we=i.useCallback(c=>{B(F,me,c)},[F]),ye=i.useCallback((c,v)=>{v==="visited"?B(M,he,c):B(L,ge,c)},[M,L]),_e=i.useCallback(c=>{fe(v=>[c,...v])},[]),D=c=>{re({message:c,show:!0}),setTimeout(()=>{re({message:"",show:!1})},3e3)};i.useEffect(()=>{window.testDataMigration=async()=>{console.log("🔍 Starting data migration test...");try{console.log("📋 Checking if migration is needed...");const c=await N.isMigrationNeeded();console.log(`Migration needed: ${c}`),console.log("⚖️ Comparing local vs Supabase data...");const v=await N.compareData();if(console.log("Data comparison:",v),c){console.log("🚀 Starting migration process...");const H=await N.createBackup();console.log("Backup created:",H);const x=await N.migrateToSupabase();console.log("Migration result:",x),x.success?(console.log("✅ Migration completed successfully!"),D("データ移行が完了しました！")):(console.log("❌ Migration failed:",x.errors),D("データ移行に失敗しました"))}else console.log("ℹ️ No migration needed"),D("移行するデータがありません");console.log("🔍 Final data comparison...");const j=await N.compareData();console.log("Final comparison:",j)}catch(c){console.error("Migration test failed:",c),D("テストに失敗しました")}},window.checkSupabaseConnection=async()=>{try{const c=await N.compareData();console.log("Supabase connection test:",c),D("接続テストが完了しました")}catch(c){console.error("Connection test failed:",c),D("接続テストに失敗しました")}},console.log("🎯 Migration test ready! Call testDataMigration() or checkSupabaseConnection() in console.")},[]);const xe=c=>{console.log("--- Feedback Submitted ---"),console.log("Type:",c.type),console.log("Details:",c.details),console.log("Screenshot (Base64):",c.screenshot?`${c.screenshot.substring(0,50)}...`:"Not provided"),console.log("--------------------------"),D("ご意見ありがとうございます！")},A=i.useMemo(()=>{const c=new Map;return Be.forEach(v=>c.set(v.placeId,v)),c},[]),Se=i.useMemo(()=>Array.from(F).map(c=>A.get(c)).filter(Boolean),[F,A]),be=i.useMemo(()=>Array.from(M).map(c=>A.get(c)).filter(Boolean),[M,A]),Ie=i.useMemo(()=>t?q.filter(c=>c.placeId===t.placeId):[],[q,t?.placeId]),De=()=>{if(t)return a.jsx(i.Suspense,{fallback:a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"})}),children:a.jsx(Ye,{shop:t,onBack:()=>s(null),isBookmarked:F.has(t.placeId),isVisited:M.has(t.placeId),isFavorite:L.has(t.placeId),onBookmarkToggle:()=>we(t.placeId),onStatusToggle:c=>ye(t.placeId,c),onAddPost:_e,userPosts:Ie})});switch(n){case"search":return a.jsx(i.Suspense,{fallback:a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"})}),children:a.jsx(le,{onShopSelect:s,searchTerm:r,setSearchTerm:o,sortKey:l,setSortKey:u,soupTypeFilter:d,setSoupTypeFilter:h,filterOpenNow:p,setFilterOpenNow:m,shops:f,setShops:w,isLocating:k,setIsLocating:g,isFiltering:_,setIsFiltering:S,userLocation:ee,hoveredPlaceId:R,setHoveredPlaceId:X,highlightedPlaceId:Q,setHighlightedPlaceId:Z})});case"mypage":return a.jsx(i.Suspense,{fallback:a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"})}),children:a.jsx(We,{bookmarkedShops:Se,visitedShops:be,userPosts:q,onShopSelect:s})});default:return a.jsx(i.Suspense,{fallback:a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"})}),children:a.jsx(le,{onShopSelect:s,searchTerm:r,setSearchTerm:o,sortKey:l,setSortKey:u,soupTypeFilter:d,setSoupTypeFilter:h,filterOpenNow:p,setFilterOpenNow:m,shops:f,setShops:w,isLocating:k,setIsLocating:g,isFiltering:_,setIsFiltering:S,userLocation:ee,hoveredPlaceId:R,setHoveredPlaceId:X,highlightedPlaceId:Q,setHighlightedPlaceId:Z})})}};return a.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-950 text-gray-200",children:[a.jsx("header",{className:"bg-gray-900 border-b border-gray-800 text-white shadow-md sticky top-0 z-30",children:a.jsx("div",{className:"container mx-auto max-w-7xl px-4 py-3 flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>{e("search"),s(null)},children:[a.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"text-red-500",children:[a.jsx("path",{d:"M4 21V19C4 17.8954 4.89543 17 6 17H10C11.1046 17 12 17.8954 12 19V21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.jsx("path",{d:"M12 21V19C12 17.8954 12.8954 17 14 17H18C19.1046 17 20 17.8954 20 19V21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.jsx("path",{d:"M7 17V11C7 8.23858 9.23858 6 12 6C14.7614 6 17 8.23858 17 11V17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.jsx("path",{d:"M12 6V3M12 3L10 4M12 3L14 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),a.jsx("h1",{className:"text-2xl font-bold tracking-wider",children:"Ramen Compass"})]})})}),a.jsx("main",{className:"flex-grow w-full max-w-7xl mx-auto",children:De()}),!t&&a.jsx("footer",{className:"sticky bottom-0 bg-gray-900/80 backdrop-blur-sm border-t border-gray-800 shadow-t-lg z-20",children:a.jsxs("div",{className:"container mx-auto max-w-7xl flex justify-around",children:[a.jsxs("button",{onClick:()=>{e("search"),s(null)},className:`flex flex-col items-center justify-center w-full py-2 text-sm font-medium transition-colors ${n==="search"?"text-red-500":"text-gray-400 hover:text-red-500"}`,children:[a.jsx(Oe,{className:"h-6 w-6 mb-0.5"}),"検索"]}),a.jsxs("button",{onClick:()=>{e("mypage"),s(null)},className:`flex flex-col items-center justify-center w-full py-2 text-sm font-medium transition-colors ${n==="mypage"?"text-red-500":"text-gray-400 hover:text-red-500"}`,children:[a.jsx(Re,{className:"h-6 w-6 mb-0.5"}),"マイページ"]})]})}),a.jsx(He,{onOpen:()=>te(!0)}),a.jsx(Je,{isOpen:ve,onClose:()=>te(!1),onSubmit:xe}),a.jsx(ze,{message:se.message,show:se.show})]})}const de="",U="";class Xe{constructor(){this.userId="ramensearch_user",this.localService=new G}isSupabaseConfigured(){return!1}async upsertUserData(e,t){const s=await fetch(`${de}/rest/v1/user_data`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U}`,apikey:U,Prefer:"resolution=merge-duplicates"},body:JSON.stringify({user_id:this.userId,favorites:e,visited:t,bookmarks:[],user_posts:[]})});if(!s.ok){const r=await s.text();throw new Error(`Failed to upsert user data: ${s.status} ${r}`)}}async getUserData(){const e=await fetch(`${de}/rest/v1/user_data?user_id=eq.${this.userId}&select=*`,{headers:{Authorization:`Bearer ${U}`,apikey:U}});if(!e.ok)throw new Error(`Failed to get user data: ${e.status}`);return(await e.json())[0]||null}async isMigrationNeeded(){try{if(!this.isSupabaseConfigured())return console.log("Supabase not configured, migration not needed"),!1;const e=await this.localService.exportUserData();if(!e.favorites.length&&!e.visits.length)return console.log("No local data found, migration not needed"),!1;const t=await this.getUserData();return t&&(t.favorites.length>0||t.visited.length>0)?(console.log("Supabase already has data, migration not needed"),!1):(console.log(`Migration needed: ${e.favorites.length} favorites, ${e.visits.length} visits`),!0)}catch(e){return console.error("Error checking migration status:",e),!1}}async migrateToSupabase(){const e={success:!1,favoritesMigrated:0,visitsMigrated:0,errors:[]};try{if(console.log("Starting simple migration to Supabase..."),!this.isSupabaseConfigured())return e.errors.push("Supabase not configured"),e;const t=await this.localService.exportUserData();if(!t.favorites.length&&!t.visits.length)return console.log("No data to migrate"),e.success=!0,e;console.log(`Migrating ${t.favorites.length} favorites and ${t.visits.length} visits`);const s=t.favorites.map(o=>({placeId:o.placeId,name:o.name,address:o.address,rating:o.rating,savedAt:o.savedAt.toISOString(),visitCount:o.visitCount||0,lastVisit:o.lastVisit?.toISOString()||null,personal_notes:o.personal_notes||"",tags:o.tags||[]})),r=t.visits.map(o=>({placeId:o.placeId,shop_name:o.shop_name||"Unknown Shop",visitDate:o.visitDate.toISOString(),rating:o.rating||null,notes:o.notes||"",photos:o.photos||[]}));return await this.upsertUserData(s,r),e.favoritesMigrated=s.length,e.visitsMigrated=r.length,e.success=!0,console.log("Migration completed successfully:",{favoritesMigrated:e.favoritesMigrated,visitsMigrated:e.visitsMigrated}),e}catch(t){const s=`Migration failed: ${t}`;return console.error(s),e.errors.push(s),e}}async testConnection(){try{return this.isSupabaseConfigured()?(await this.getUserData(),console.log("Supabase connection test successful"),!0):!1}catch(e){return console.error("Supabase connection test failed:",e),!1}}}const K=new Xe;async function Qe(){console.log("=== RamenSearch Data Migration Test ===");try{if(console.log("1. Testing Supabase connection..."),!await K.testConnection()){console.error("❌ Supabase connection failed");return}if(console.log("✅ Supabase connection successful"),console.log("2. Checking if migration is needed..."),!await K.isMigrationNeeded()){console.log("ℹ️ Migration not needed (no local data or already migrated)");return}console.log("✅ Migration needed"),console.log("3. Executing migration...");const t=await K.migrateToSupabase();return t.success?(console.log("✅ Migration completed successfully!"),console.log(`   - Favorites migrated: ${t.favoritesMigrated}`),console.log(`   - Visits migrated: ${t.visitsMigrated}`)):(console.error("❌ Migration failed:"),t.errors.forEach(s=>console.error(`   - ${s}`))),t}catch(n){throw console.error("❌ Migration test failed:",n),n}}window.runMigrationTest=Qe;class Ze{constructor(){throw this.userId="ramensearch_user",new Error("Supabase configuration missing")}dbFavoriteToApp(e){return{id:e.id,user_id:e.user_id,placeId:e.place_id,name:e.name,address:e.address||"",rating:e.rating||0,savedAt:new Date(e.saved_at),visitCount:e.visit_count,lastVisit:e.last_visit?new Date(e.last_visit):void 0,personal_notes:e.personal_notes||"",tags:e.tags||[],created_at:new Date(e.created_at)}}dbVisitToApp(e){return{id:e.id,user_id:e.user_id,placeId:e.place_id,shop_name:e.shop_name,visitDate:new Date(e.visit_date),rating:e.rating||void 0,notes:e.notes||"",photos:e.photos||[],created_at:new Date(e.created_at)}}async getFavorites(){try{const{data:e,error:t}=await this.supabase.from("favorites").select("*").eq("user_id",this.userId).order("saved_at",{ascending:!1});if(t)throw t;return(e||[]).map(this.dbFavoriteToApp)}catch(e){return console.error("Failed to get favorites:",e),[]}}async addToFavorites(e){try{if(await this.isFavorite(e.placeId))return;const{error:s}=await this.supabase.from("favorites").insert({user_id:this.userId,place_id:e.placeId,name:e.name,address:e.address,rating:e.rating,visit_count:0,personal_notes:"",tags:[]});if(s)throw s}catch(t){throw console.error("Failed to add to favorites:",t),t}}async removeFromFavorites(e){try{const{error:t}=await this.supabase.from("favorites").delete().eq("user_id",this.userId).eq("place_id",e);if(t)throw t}catch(t){throw console.error("Failed to remove from favorites:",t),t}}async isFavorite(e){try{const{data:t,error:s}=await this.supabase.from("favorites").select("id").eq("user_id",this.userId).eq("place_id",e).single();return s&&s.code!=="PGRST116"?!1:!!t}catch{return!1}}async getVisitHistory(){try{const{data:e,error:t}=await this.supabase.from("visit_history").select("*").eq("user_id",this.userId).order("visit_date",{ascending:!1}).limit(100);if(t)throw t;return(e||[]).map(this.dbVisitToApp)}catch(e){return console.error("Failed to get visit history:",e),[]}}async addVisit(e){try{const{error:t}=await this.supabase.from("visit_history").insert({user_id:this.userId,place_id:e.placeId,shop_name:e.shop_name,visit_date:(e.visitDate||new Date).toISOString(),rating:e.rating||null,notes:e.notes||"",photos:e.photos||[]});if(t)throw t;await this.updateVisitCount(e.placeId)}catch(t){throw console.error("Failed to add visit:",t),t}}async updateVisitCount(e){try{const{count:t}=await this.supabase.from("visit_history").select("*",{count:"exact",head:!0}).eq("user_id",this.userId).eq("place_id",e),{data:s}=await this.supabase.from("visit_history").select("visit_date").eq("user_id",this.userId).eq("place_id",e).order("visit_date",{ascending:!1}).limit(1).single();await this.supabase.from("favorites").update({visit_count:t||0,last_visit:s?.visit_date||null,updated_at:new Date().toISOString()}).eq("user_id",this.userId).eq("place_id",e)}catch(t){console.error("Failed to update visit count:",t)}}async exportUserData(){try{const[e,t]=await Promise.all([this.getFavorites(),this.getVisitHistory()]);return{favorites:e,visits:t}}catch(e){return console.error("Failed to export user data:",e),{favorites:[],visits:[]}}}async testConnection(){try{const{error:e}=await this.supabase.from("favorites").select("count",{count:"exact",head:!0}).eq("user_id",this.userId);return!e}catch{return!1}}}const y=new Ze,O={placeId:"test_place_001",name:"テストラーメン店",address:"東京都渋谷区テスト1-1-1",rating:4.5,photos:[],lat:35.6586,lng:139.7454,hours:"11:00-22:00",website:"https://test-ramen.com",reviews:[],distance:0,keywords:["ラーメン","テスト"],isOpenNow:!0,congestion:"普通",accessInfo:"JR渋谷駅より徒歩5分",menu:[],parkingInfo:"近隣にコインパーキングあり"};async function et(){console.log("=== 新しいSupabaseテーブル構造テスト ===");try{console.log("1. 接続テスト...");const n=await y.testConnection();if(!n){console.error("❌ Supabase接続失敗");return}console.log("✅ Supabase接続成功"),console.log("2. 既存データ確認...");const e=await y.getFavorites(),t=await y.getVisitHistory();console.log(`   現在のお気に入り: ${e.length}件`),console.log(`   現在の訪問履歴: ${t.length}件`),console.log("3. お気に入り追加テスト...");const s=await y.isFavorite(O.placeId);console.log(`   追加前の状態: ${s?"お気に入り済み":"お気に入りなし"}`),s?console.log("ℹ️ 既にお気に入り登録済み"):(await y.addToFavorites(O),console.log("✅ お気に入り追加成功")),console.log("4. お気に入り確認...");const r=await y.isFavorite(O.placeId);console.log(`   確認結果: ${r?"✅ お気に入り登録済み":"❌ お気に入り未登録"}`),console.log("5. お気に入り一覧取得...");const o=await y.getFavorites();if(console.log(`   取得件数: ${o.length}件`),o.length>0){console.log("   最新のお気に入り:");const d=o[0];console.log(`     - ${d.name} (${d.address})`),console.log(`     - 評価: ${d.rating}`),console.log(`     - 訪問回数: ${d.visitCount}`)}console.log("6. 訪問履歴追加テスト..."),await y.addVisit({placeId:O.placeId,shop_name:O.name,rating:5,notes:"とても美味しかった！",photos:[]}),console.log("✅ 訪問履歴追加成功"),console.log("7. 訪問履歴確認...");const l=await y.getVisitHistory();if(console.log(`   訪問履歴件数: ${l.length}件`),l.length>0){console.log("   最新の訪問:");const d=l[0];console.log(`     - ${d.shop_name}`),console.log(`     - 評価: ${d.rating}`),console.log(`     - メモ: ${d.notes}`),console.log(`     - 訪問日: ${d.visitDate.toLocaleDateString()}`)}console.log("8. データエクスポートテスト...");const u=await y.exportUserData();return console.log(`   エクスポート - お気に入り: ${u.favorites.length}件`),console.log(`   エクスポート - 訪問履歴: ${u.visits.length}件`),console.log(`
🎉 すべてのテストが完了しました！`),{connectionOk:n,favorites:o.length,visits:l.length,testShopAdded:r}}catch(n){throw console.error("❌ テスト中にエラーが発生:",n),n}}window.runSupabaseNewTest=et;const pe=document.getElementById("root");if(!pe)throw new Error("Could not find root element to mount to");const tt=Pe.createRoot(pe);tt.render(a.jsx(P.StrictMode,{children:a.jsx(Ge,{})}));export{Y as _,ot as f,at as g,a as j};
