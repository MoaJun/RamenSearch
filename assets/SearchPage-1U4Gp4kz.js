import{j as s}from"./index-Dq7NBkUu.js";import{r as f,l as ee,e as se,m as re}from"./ui-D1brmElj.js";import{a as ae}from"./RamenShopListItem-DSriu-Ab.js";import{l as te}from"./googleMaps-dUlr1ba2.js";import"./vendor-D3F3s8fL.js";import"./ReviewSummary-B4aI4XXt.js";import"./ai-8rzRUgYl.js";import"./google-maps-93e-Jyro.js";const ne=()=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden animate-pulse",children:[s.jsx("div",{className:"w-full h-40 bg-gray-300 dark:bg-gray-700"}),s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:s.jsx("div",{className:"w-7 h-7 bg-gray-300 dark:bg-gray-700 rounded-full"})}),s.jsxs("div",{className:"flex-grow min-w-0 space-y-2",children:[s.jsx("div",{className:"h-5 w-3/4 bg-gray-300 dark:bg-gray-700 rounded"}),s.jsx("div",{className:"h-4 w-full bg-gray-200 dark:bg-gray-600 rounded"}),s.jsxs("div",{className:"flex gap-4 pt-1",children:[s.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-600 rounded"}),s.jsx("div",{className:"h-4 w-16 bg-gray-200 dark:bg-gray-600 rounded"}),s.jsx("div",{className:"h-4 w-20 bg-gray-200 dark:bg-gray-600 rounded"})]})]})]})}),s.jsxs("div",{className:"px-4 pt-3 pb-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:[s.jsx("div",{className:"h-3 w-1/4 bg-gray-200 dark:bg-gray-600 rounded mb-3"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-3 w-1/2 bg-gray-200 dark:bg-gray-600 rounded"}),s.jsx("div",{className:"h-3 w-full bg-gray-200 dark:bg-gray-600 rounded"})]})]}),s.jsx("div",{className:"px-4 py-3 border-t border-gray-100 dark:border-gray-700",children:s.jsx("div",{className:"h-5 w-1/2 mx-auto bg-gray-200 dark:bg-gray-600 rounded-full"})})]}),oe=["醤油","豚骨","家系","味噌","担々麺","鶏白湯","煮干","昆布水","貝出汁","鴨出汁","二郎"],ie=["ラーメン","ラーメン屋","拉麺","ramen","中華そば","麺","らーめん","麺処","麺屋","麺ダイニング","家系","鶏soba","らー麺","中華蕎麦","らぁ麺","らぁめん","麺や","えびそば","麺堂","麺匠","麺宿","つけ麺","鶏そば","Ramen","SOBA","油そば","製麺","タンメン","担々麺","鯛塩そば","つけめん","支那そば","まぜそば","Noodle","ラー麺"],le=["洋食","居酒屋","イタリアン","フレンチ","カフェ","coffee","レストラン","bistro","brasserie","trattoria","osteria","うどん","蕎麦","そば","スパゲッティ","パスタ","ピザ","pizza","バー","bar","焼肉","yakiniku","寿司","sushi","天ぷら","tempura","定食","teishoku"],L={strong:["ラーメン","拉麺","ramen","中華そば","つけ麺","油そば","混ぜそば","二郎","家系","豚骨","味噌","醤油","塩ラーメン"],medium:["麺","そば","noodle","メン","麺屋","らーめん"],weak:["チャーシュー","替え玉","煮卵","もやし","のり","背脂"]},ce=_=>{const v=_.name||"",k=_.vicinity||"",w=_.types||[],j=`${v} ${k} ${w.join(" ")}`.toLowerCase();if(le.some(d=>j.includes(d.toLowerCase())))return{isRamenShop:!1,confidence:.9,reason:"exclude_keyword_found"};let y=0;const g=[];L.strong.forEach(d=>{j.includes(d.toLowerCase())&&(y+=10,g.push(`strong:${d}`))}),L.medium.forEach(d=>{j.includes(d.toLowerCase())&&(y+=5,g.push(`medium:${d}`))}),L.weak.forEach(d=>{j.includes(d.toLowerCase())&&(y+=2,g.push(`weak:${d}`))}),(w.includes("restaurant")||w.includes("meal_takeaway"))&&(y+=3);const R=Math.min(y/10,1),N=y>=5;return console.log(`${v}: score=${y}, confidence=${R}, indicators=[${g.join(",")}]`),{isRamenShop:N,confidence:R,reason:g.length>0?g.join(","):"no_indicators"}},J=_=>{const v=[[{name:"醤油ラーメン",price:"800円"},{name:"味玉ラーメン",price:"950円"},{name:"チャーシューメン",price:"1,200円"},{name:"餃子 (5個)",price:"450円"},{name:"ライス",price:"150円"}],[{name:"豚骨ラーメン",price:"900円"},{name:"特製ラーメン",price:"1,100円"},{name:"チャーシュー丸",price:"350円"},{name:"キムチ",price:"200円"},{name:"替え玉",price:"100円"},{name:"瓶ビール",price:"600円"}],[{name:"味噌ラーメン",price:"850円"},{name:"野菜ラーメン",price:"1,000円"},{name:"コーンバター",price:"100円"},{name:"もやし",price:"200円"}]],k=_.split("").reduce((w,j)=>w+j.charCodeAt(0),0);return v[k%v.length]},xe=({onShopSelect:_,searchTerm:v,setSearchTerm:k,sortKey:w,setSortKey:j,soupTypeFilter:M,setSoupTypeFilter:y,filterOpenNow:g,setFilterOpenNow:R,shops:N,setShops:d,isLocating:D,setIsLocating:B,isFiltering:H,setIsFiltering:$,userLocation:u,hoveredPlaceId:G,setHoveredPlaceId:q,highlightedPlaceId:I,setHighlightedPlaceId:C})=>{const[A,Q]=f.useState(null),O=f.useRef(null),S=f.useRef(null),U=f.useRef([]),Y=f.useRef({});f.useEffect(()=>{(async()=>{try{await te(),window.google&&window.google.maps&&!A&&Q(new window.google.maps.Geocoder)}catch(r){console.error("Failed to load Google Maps API:",r),alert("Google Maps APIの読み込みに失敗しました。APIキーを確認してください。")}})()},[A]),f.useEffect(()=>{O.current&&!S.current&&window.google&&(S.current=new window.google.maps.Map(O.current,{center:u.current||{lat:35.681236,lng:139.767125},zoom:14,mapId:"281e9bf8d5a1aa29156aabcf",disableDefaultUI:!0}),S.current.addListener("click",()=>{C(null)}))},[]),f.useEffect(()=>{if(S.current&&(U.current.forEach(e=>e.setMap(null)),U.current=[],N.length>0)){N.forEach((r,i)=>{if(r.lat&&r.lng){const o=G===r.placeId||I===r.placeId,l=new window.google.maps.Marker({position:{lat:r.lat,lng:r.lng},map:S.current,title:r.name,label:`${i+1}`,zIndex:o?1e3:1,animation:o?window.google.maps.Animation.BOUNCE:null});o&&setTimeout(()=>{l.setAnimation(null)},2100),l.addListener("click",()=>{const m=I===r.placeId?null:r.placeId;if(C(m),m){const n=Y.current[r.placeId];n&&n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}),U.current.push(l)}});const e=new window.google.maps.LatLngBounds;N.forEach(r=>{r.lat&&r.lng&&e.extend({lat:r.lat,lng:r.lng})}),S.current.fitBounds(e)}},[N,G,I,C]);const T=f.useCallback((e,r,i,o)=>{const m=e*Math.PI/180,n=i*Math.PI/180,c=(i-e)*Math.PI/180,a=(o-r)*Math.PI/180,t=Math.sin(c/2)*Math.sin(c/2)+Math.cos(m)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))},[]),V=f.useCallback(async(e,r)=>{const i=new Map,o=[],l=ie.map(async n=>{const c={location:e,radius:300,keyword:n,type:"restaurant"};try{const a=await new Promise(t=>{r.nearbySearch(c,(b,x)=>{x===google.maps.places.PlacesServiceStatus.OK&&b?t(b):t([])})});return{keyword:n,results:a||[]}}catch(a){return console.warn(`Search failed for keyword: ${n}`,a),{keyword:n,results:[]}}});return(await Promise.all(l)).forEach(({keyword:n,results:c})=>{c.forEach(a=>{if(a.place_id&&!i.has(a.place_id)){const t=ce(a);t.isRamenShop&&t.confidence>=.5?i.set(a.place_id,{...a,evaluation:t,searchKeyword:n}):o.push(`${a.name} (${t.reason}, confidence: ${t.confidence.toFixed(2)})`)}})}),console.log("Smart filtering results:"),console.log(`- Accepted: ${i.size} ramen shops`),console.log(`- Rejected: ${o.length} non-ramen places`),o.length>0&&console.log(`- Rejected places: ${o.slice(0,5).join(", ")}${o.length>5?"...":""}`),Array.from(i.values())},[]),X=e=>{if(!e||!e.periods)return!1;const r=new Date,i=r.getDay(),o=r.getHours()*100+r.getMinutes();for(const l of e.periods)if(l.open.day===i){const m=parseInt(l.open.time,10);if(!l.close)return!0;const n=parseInt(l.close.time,10);if(m<=o&&o<n)return!0}return!1},Z=async()=>{if(!navigator.geolocation){alert("お使いのブラウザは位置情報機能に対応していません。");return}B(!0),$(!0),k("現在地周辺");try{const e=await new Promise((m,n)=>{navigator.geolocation.getCurrentPosition(m,n)}),{latitude:r,longitude:i}=e.coords;if(u.current={lat:r,lng:i},!window.google||!window.google.maps||!window.google.maps.places)throw new Error("Google Maps API is not loaded.");const o=new window.google.maps.places.PlacesService(document.createElement("div")),l=await V(u.current,o);if(console.log("Comprehensive search results:",l),l&&l.length>0){const m=l.map(c=>new Promise(a=>{if(!c.place_id){a(null);return}o.getDetails({placeId:c.place_id,fields:["name","rating","formatted_address","geometry","opening_hours","website","photos","reviews","types","formatted_phone_number","vicinity"]},(t,b)=>{if(b===google.maps.places.PlacesServiceStatus.OK&&t){const x=t.geometry?.location?.lat(),E=t.geometry?.location?.lng(),W=x&&E&&u.current?T(u.current.lat,u.current.lng,x,E):0,K=t.photos&&t.photos.length>0?t.photos.slice(0,4).map((h,P)=>({small:h.getUrl({maxWidth:400,maxHeight:300}),medium:h.getUrl({maxWidth:800,maxHeight:600}),large:h.getUrl({maxWidth:1200,maxHeight:900}),alt:`${t.name||""} - ${P+1}`})):[{small:"https://picsum.photos/seed/ramen-default/400/300",medium:"https://picsum.photos/seed/ramen-default/800/600",large:"https://picsum.photos/seed/ramen-default/1200/900",alt:t.name||"ラーメン店"}],p={placeId:t.place_id||`temp-${Math.random().toString(36).substring(2,15)}`,name:t.name||"",photos:K,rating:t.rating||0,address:t.formatted_address||"",lat:x||0,lng:E||0,hours:t.opening_hours?.weekday_text?.join(`
`)||"営業時間情報なし",website:t.website||"",reviews:t.reviews?.map(h=>({author:h.author_name||"",text:h.text||"",rating:h.rating||0,time:h.time,relative_time_description:h.relative_time_description}))||[],distance:W,keywords:t.types||[],isOpenNow:X(t.opening_hours),congestion:"不明",accessInfo:"",menu:J(t.place_id||""),parkingInfo:"近隣コインパーキングあり"};a(p)}else a(null)})})),n=(await Promise.all(m)).filter(c=>c!==null);d(n.sort((c,a)=>c.distance-a.distance))}else console.warn("No search results found"),d([])}catch(e){console.error("An error occurred:",e),alert("検索中にエラーが発生しました。"),d([])}finally{B(!1),$(!1)}},F=async()=>{if(!A||!window.google||!window.google.maps.places){alert("Google Maps APIがロードされていません。");return}$(!0);try{const e=await new Promise(l=>{A.geocode({address:v},(m,n)=>{l({results:m||[],status:n})})});if(e.status!==google.maps.GeocoderStatus.OK||!e.results||e.results.length===0)throw new Error("Geocoding failed or returned no results.");const r=e.results[0].geometry.location;u.current={lat:r.lat(),lng:r.lng()};const i=new window.google.maps.places.PlacesService(document.createElement("div")),o=await V(u.current,i);if(console.log("Comprehensive search results (by area):",o),o&&o.length>0){const l=o.map(n=>new Promise(c=>{if(!n.place_id){c(null);return}i.getDetails({placeId:n.place_id,fields:["name","rating","formatted_address","geometry","opening_hours","website","photos","reviews","types","formatted_phone_number","vicinity"]},(a,t)=>{if(t===google.maps.places.PlacesServiceStatus.OK&&a){const b=a.geometry?.location?.lat(),x=a.geometry?.location?.lng(),E=b&&x&&u.current?T(u.current.lat,u.current.lng,b,x):0,W=a.photos&&a.photos.length>0?a.photos.slice(0,4).map((p,h)=>({small:p.getUrl({maxWidth:400,maxHeight:300}),medium:p.getUrl({maxWidth:800,maxHeight:600}),large:p.getUrl({maxWidth:1200,maxHeight:900}),alt:`${a.name||""} - ${h+1}`})):[{small:"https://picsum.photos/seed/ramen-default/400/300",medium:"https://picsum.photos/seed/ramen-default/800/600",large:"https://picsum.photos/seed/ramen-default/1200/900",alt:a.name||"ラーメン店"}],K={placeId:a.place_id||`temp-${Math.random().toString(36).substring(2,15)}`,name:a.name||"",photos:W,rating:a.rating||0,address:a.formatted_address||"",lat:b||0,lng:x||0,hours:a.opening_hours?.weekday_text?.join(`
`)||"営業時間情報なし",website:a.website||"",reviews:a.reviews?.map(p=>({author:p.author_name||"",text:p.text||"",rating:p.rating||0,time:p.time,relative_time_description:p.relative_time_description}))||[],distance:E,keywords:a.types||[],isOpenNow:X(a.opening_hours),congestion:"不明",accessInfo:"",menu:J(a.place_id||""),parkingInfo:"近隣コインパーキングあり"};c(K)}else c(null)})})),m=(await Promise.all(l)).filter(n=>n!==null);d(m.sort((n,c)=>n.distance-c.distance))}else console.warn("No search results found"),d([])}catch(e){console.error("An error occurred during area search:",e),alert("指定された場所が見つかりませんでした。"),d([])}finally{$(!1)}},z=f.useMemo(()=>N.filter(e=>{const r=M===""||e.name.toLowerCase().includes(M.toLowerCase())||e.reviews.some(o=>o.text.toLowerCase().includes(M.toLowerCase())),i=!g||e.isOpenNow;return r&&i}).sort((e,r)=>w==="rating"?r.rating-e.rating:e.distance-r.distance),[N,w,M,g]);return s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 lg:grid-rows-[auto_1fr] lg:gap-8",children:[s.jsx("div",{className:"lg:col-span-7",children:s.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg shadow-md z-10",children:[s.jsxs("button",{onClick:Z,disabled:D,className:"w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed mb-3",children:[s.jsx(ee,{className:`h-5 w-5 mr-2 ${D?"animate-spin":""}`}),D?"現在地を検索中...":"現在地で周囲を検索"]}),s.jsxs("div",{className:"relative mb-3",children:[s.jsx(se,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 h-5 w-5 pointer-events-none"}),s.jsx("input",{id:"location-search",type:"text",placeholder:"駅名・住所・郵便番号",value:v,onChange:e=>k(e.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-700 rounded-lg shadow-sm focus:ring-2 focus:ring-red-500 transition bg-gray-800 text-white"})]}),s.jsx("button",{onClick:F,className:"w-full bg-gray-700 text-gray-200 font-bold py-3 rounded-lg hover:bg-gray-600 transition shadow-md border border-gray-600",children:"このエリアで検索"})]})}),s.jsx("div",{className:"mt-4 h-64 md:h-80 bg-gray-800 rounded-lg shadow-inner relative overflow-hidden lg:col-span-5 lg:row-span-2 lg:col-start-8 lg:row-start-1 lg:mt-0 lg:sticky lg:top-[100px] lg:h-[calc(100vh-160px)] lg:max-h-[800px] transition-all duration-300",children:s.jsx("div",{ref:O,className:"w-full h-full"})}),s.jsxs("div",{className:"mt-4 lg:col-span-7 lg:row-start-2 lg:max-h-[calc(100vh-200px)] lg:overflow-y-auto lg:pr-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[s.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[s.jsx("label",{htmlFor:"soup-type",className:"sr-only",children:"スープの種類"}),s.jsxs("select",{id:"soup-type",value:M,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-700 rounded-md focus:ring-2 focus:ring-red-500 bg-gray-800 text-white transition shadow-sm",children:[s.jsx("option",{value:"",children:"全てのスープ"}),oe.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-200",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:()=>R(!g),className:"form-checkbox h-4 w-4 rounded text-red-600 focus:ring-red-500 border-gray-600 bg-gray-700"}),s.jsx("span",{children:"営業中のみ表示"})]})]}),s.jsxs("button",{onClick:()=>j(w==="distance"?"rating":"distance"),className:"flex items-center px-4 py-2 bg-gray-800 border border-gray-700 rounded-full text-sm text-gray-200 hover:bg-gray-700 transition shadow-sm",children:[s.jsx(re,{className:"h-4 w-4 mr-1.5"}),w==="distance"?"距離が近い順":"評価が高い順"]})]}),s.jsxs("p",{className:"text-sm text-gray-400 mb-3",children:["検索結果: ",H?"...":`${z.length}件`]}),s.jsx("div",{className:"space-y-4",children:H?Array.from({length:3}).map((e,r)=>s.jsx(ne,{},r)):z.length>0?z.map((e,r)=>s.jsx("div",{ref:i=>{Y.current[e.placeId]=i},className:"animate-slide-in-bottom",style:{animationDelay:`${r*70}ms`},children:s.jsx(ae,{shop:e,index:r+1,onSelect:()=>_(e),isHovered:G===e.placeId,isHighlighted:I===e.placeId,onMouseEnter:()=>q(e.placeId),onMouseLeave:()=>q(null),onClick:()=>C(I===e.placeId?null:e.placeId)})},e.placeId)):s.jsx("div",{className:"text-center py-10 bg-gray-900 rounded-lg shadow-md",children:s.jsx("p",{className:"text-gray-400",children:"条件に合うラーメン屋が見つかりませんでした。"})})})]})]})};export{xe as default};
