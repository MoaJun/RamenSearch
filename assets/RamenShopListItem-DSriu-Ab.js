import{j as e,f as j}from"./index-Dq7NBkUu.js";import{r as c,g as S,R as F,d as C,e as p,T as P,a as E,b as A,i as N,n as L,o as z}from"./ui-D1brmElj.js";import{R as M}from"./ReviewSummary-B4aI4XXt.js";const O=({photo:r,className:a,sizes:l})=>{if(!r)return e.jsx("div",{className:`bg-gray-200 dark:bg-gray-700 ${a}`});const i=`${r.small} 400w, ${r.medium} 800w, ${r.large} 1200w`;return e.jsx("img",{src:r.small,srcSet:i,sizes:l,alt:r.alt,className:a,loading:"lazy"})},T=({shop:r,size:a="medium",className:l="",showLabel:i=!1})=>{const[n,x]=c.useState(!1),[m,h]=c.useState(!1),o={small:"w-6 h-6",medium:"w-8 h-8",large:"w-10 h-10"},b={small:"p-1",medium:"p-2",large:"p-3"};c.useEffect(()=>{d()},[r.placeId]);const d=async()=>{try{const t=await j.isFavorite(r.placeId);x(t)}catch(t){console.error("Error checking favorite status:",t)}},f=async t=>{if(t.stopPropagation(),!m){h(!0);try{n?(await j.removeFromFavorites(r.placeId),x(!1)):(await j.addToFavorites(r),x(!0))}catch(g){console.error("Error toggling favorite:",g),alert("お気に入りの更新に失敗しました。もう一度お試しください。")}finally{h(!1)}}};return e.jsxs("button",{onClick:f,disabled:m,className:`
        ${b[a]}
        inline-flex items-center justify-center
        rounded-full
        transition-all duration-200
        ${n?"text-red-500 hover:text-red-600 hover:bg-red-50":"text-gray-400 hover:text-red-500 hover:bg-gray-50"}
        ${m?"opacity-50 cursor-not-allowed":"hover:scale-110"}
        ${l}
      `,title:n?"お気に入りから削除":"お気に入りに追加","aria-label":n?"お気に入りから削除":"お気に入りに追加",children:[e.jsx(S,{className:`${o[a]} ${n?"fill-current":""}`}),i&&e.jsx("span",{className:"ml-1 text-sm font-medium",children:n?"お気に入り":"お気に入りに追加"})]})},_=({status:r})=>{const a={混雑:{text:"混雑",color:"text-red-600 dark:text-red-500",bgColor:"bg-red-100 dark:bg-red-900/50"},普通:{text:"普通",color:"text-yellow-600 dark:text-yellow-500",bgColor:"bg-yellow-100 dark:bg-yellow-900/50"},空席あり:{text:"空席あり",color:"text-green-600 dark:text-green-500",bgColor:"bg-green-100 dark:bg-green-900/50"},不明:{text:"不明",color:"text-gray-500 dark:text-gray-400",bgColor:"bg-gray-100 dark:bg-gray-700"}},{text:l,color:i,bgColor:n}=a[r];return e.jsxs("span",{className:`inline-flex items-center text-xs font-semibold px-2 py-1 rounded-full ${n} ${i}`,children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),l]})},k=({review:r})=>e.jsxs("div",{className:"py-2 border-b border-gray-100 dark:border-gray-700/50 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((a,l)=>e.jsx(C,{className:`w-3.5 h-3.5 ${l<r.rating?"text-yellow-400":"text-gray-400 dark:text-gray-500"}`,fill:"currentColor"},l))}),e.jsx("p",{className:"ml-2 font-semibold text-gray-700 dark:text-gray-300 text-sm",children:r.author})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed line-clamp-3",children:r.text})]}),B=({shop:r,onSelect:a,index:l,isHovered:i,isHighlighted:n,onMouseEnter:x,onMouseLeave:m,onClick:h})=>{const[o,b]=c.useState(!1),[d,f]=c.useState(!1),[t,g]=c.useState(0),u=4,w=r.reviews.slice(1),v=Math.ceil(w.length/u),I=w.slice(t*u,(t+1)*u),R=s=>{s.stopPropagation(),o&&g(0),b(!o)},$=s=>{s.stopPropagation(),f(!d)};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-all duration-300 group ${n?"ring-2 ring-blue-500 shadow-lg transform scale-105":i?"ring-2 ring-red-500":""}`,onMouseEnter:x,onMouseLeave:m,onClick:h,children:[e.jsxs("div",{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",onClick:a,children:[e.jsx(O,{photo:r.photos[0],sizes:"(max-width: 768px) 100vw, 50vw",className:"w-full h-40 object-cover"}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("span",{className:"flex items-center justify-center w-7 h-7 bg-red-600 text-white rounded-full font-bold text-sm shadow-md",children:l})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 truncate flex-1 mr-2",children:r.name}),e.jsx(T,{shop:r,size:"medium"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx(C,{className:"w-4 h-4 text-yellow-500 dark:text-yellow-400 mr-1 flex-shrink-0",fill:"currentColor"}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400 mr-2",children:r.rating.toFixed(1)}),e.jsx("span",{className:"mr-2",children:"·"}),e.jsx(p,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r.address})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500"}),r.accessInfo]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(p,{className:"w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500"}),"約 ",Math.round(r.distance),"m"]}),e.jsx(_,{status:r.congestion})]})]})]})})]}),r.reviews&&r.reviews.length>0&&e.jsxs("div",{className:"px-4 pt-3 pb-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"最新のレビュー"}),e.jsx(k,{review:r.reviews[0]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 space-y-2",children:I.map((s,y)=>e.jsx(k,{review:s},y))}),v>1&&e.jsxs("div",{className:"flex justify-between items-center mt-3 text-sm",children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),g(y=>y-1)},disabled:t===0,className:"flex items-center p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"前へ"})]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-semibold",children:[t+1," / ",v]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),g(y=>y+1)},disabled:t>=v-1,className:"flex items-center p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx("span",{className:"hidden sm:inline",children:"次へ"}),e.jsx(A,{className:"w-5 h-5"})]})]})]}),r.reviews.length>1&&e.jsxs("button",{onClick:R,className:"w-full mt-2 text-center text-red-600 dark:text-red-500 font-semibold text-sm hover:text-red-800 dark:hover:text-red-400 flex items-center justify-center",children:[o?"レビューを閉じる":`他のレビュー${r.reviews.length-1}件を表示`,e.jsx(N,{className:`w-5 h-5 ml-1 transition-transform ${o?"rotate-180":""}`})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("button",{onClick:$,className:"w-full text-red-600 dark:text-red-500 font-semibold text-sm hover:text-red-800 dark:hover:text-red-400 flex items-center justify-center",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),d?"AI要約を閉じる":"AIによるクチコミ要約を見る",e.jsx(N,{className:`w-5 h-5 ml-1 transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsx("div",{className:"mt-3",children:e.jsx(M,{placeId:r.placeId,reviews:r.reviews})})]}),r.keywords&&r.keywords.length>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 px-4 py-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.keywords.slice(0,4).map(s=>e.jsx("span",{className:"text-xs bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300 px-2 py-1 rounded-full",children:s},s))})})]})},U=F.memo(B);export{O as R,U as a};
